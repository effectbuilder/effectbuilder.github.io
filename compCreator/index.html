<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SRGB Custom Component Creator</title>
    <meta property="og:title" content="SRGB Custom Component Creator">
    <meta property="og:description" content="A tool for creating custom LED component layouts for SignalRGB.">
    <meta property="og:type" content="website">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <script type="module" src="firebase.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>

<body class="d-flex flex-column vh-100">
    <nav class="navbar navbar-expand-lg bg-body-tertiary">
        <div class="container-fluid">
            <a class="navbar-brand d-flex align-items-center" href="./">
                <i class="bi bi-tools me-2"></i> SRGB Custom Component Creator
            </a>

            <div class="ms-auto d-flex align-items-center">

                <div class="btn-group me-3" role="group" aria-label="Project management actions">
                    <button class="btn btn-primary" id="new-component-btn" data-bs-toggle="tooltip" title="New Component"><i class="bi bi-file-earmark-plus me-1"></i> New</button>
                    <button class="btn btn-primary" id="save-component-btn" data-bs-toggle="tooltip" title="Save current component to the cloud" disabled><i class="bi bi-cloud-arrow-up me-1"></i> Save</button>
                    <button class="btn btn-primary" id="load-component-btn" data-bs-toggle="offcanvas" data-bs-target="#gallery-offcanvas" aria-controls="gallery-offcanvas" title="Load one of your saved components" disabled><i class="bi bi-folder2-open me-1"></i> Open</button>
                    <button class="btn btn-secondary" id="share-component-btn" data-bs-toggle="tooltip" title="Get a shareable link to this component" disabled><i class="bi bi-share me-1"></i> Share</button>
                    <button class="btn btn-secondary" id="export-component-btn" data-bs-toggle="modal" data-bs-target="#export-component-modal" title="Download Component JSON file"> <i class="bi bi-download me-1"></i> Export JSON</button>
                </div>

                <div class="btn-group me-3" role="group" aria-label="Community">
                    <button class="btn btn-primary" id="browse-gallery-btn" data-bs-toggle="offcanvas" data-bs-target="#gallery-offcanvas" aria-controls="gallery-offcanvas" title="Browse the Community Component Gallery"><i class="bi bi-view-list me-1"></i> Community Gallery</button>
                </div>

                <div class="btn-group me-3" role="group" aria-label="Help and settings">
                    <button class="btn btn-secondary" id="help-btn" data-bs-toggle="modal" data-bs-target="#help-modal" title="Help"><i class="bi bi-question-circle"></i></button>
                    <button class="btn btn-secondary" id="about-btn" data-bs-toggle="modal" data-bs-target="#about-modal" title="About"><i class="bi bi-info-circle"></i></button>
                    <a class="btn btn-secondary" id="contact-btn" href="#" target="_blank" rel="noopener" title="Report Bug / Request Feature on GitHub">
                        <i class="bi bi-github"></i>
                    </a>
                    <button class="btn btn-secondary" type="button" id="theme-switcher-btn" title="Change Theme">
                        <i class="bi" id="theme-icon"></i>
                    </button>
                </div>

                <div id="auth-notification-block" class="d-flex align-items-center">
                    <button class="btn btn-success" id="login-btn"><i class="bi bi-google me-2"></i>Sign In</button>
                    <div class="btn-group d-none" id="user-session-group" role="group" aria-label="User actions">
                        <div class="btn-group" role="group">
                            <button class="btn btn-info dropdown-toggle position-relative" type="button" id="notification-dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="bi bi-bell"></i>
                                <span id="notification-badge" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger d-none">
                                    0
                                    <span class="visually-hidden">new notifications</span>
                                </span>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end dropdown-menu-dark p-2" aria-labelledby="notification-dropdown-toggle" style="min-width: 300px;">
                            </ul>
                        </div>
                        <span class="btn btn-secondary d-flex align-items-center disabled" style="pointer-events: none;">
                            <img id="user-photo" class="rounded-circle me-2" style="width: 24px; height: 24px;" alt="User profile photo">
                            <span id="user-display"></span>
                        </span>
                        <button class="btn btn-danger" id="logout-btn" title="Sign Out"><i class="bi bi-box-arrow-right"></i></button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="container-fluid flex-grow-1 overflow-hidden p-0">
        <div class="h-100" id="main-split">

            <div id="left-panel" class="h-100 p-3 border-end bg-body-tertiary" style="overflow: auto;">
                <div class="h-100 d-flex flex-column">
                    <div id="component-properties" class="mb-3">
                        <h4 class="text-body-emphasis">Component Properties</h4>
                        <div class="mb-2">
                            <label for="component-name" class="form-label form-label-sm">Component Name</label>
                            <input type="text" id="component-name" class="form-control form-control-sm" placeholder="My Custom Component">
                        </div>
                        <div class="mb-2">
                            <label for="component-type" class="form-label form-label-sm">Component Type</label>
                            <select id="component-type" class="form-select form-select-sm">
                                <option>Strip</option>
                                <option>Matrix</option>
                                <option>Fan</option>
                                <option>Keyboard</option>
                                <option>Mouse</option>
                                <option>Other</option>
                            </select>
                        </div>
                        <div class="mb-2">
                            <label for="component-image" class="form-label form-label-sm">Device Image (Optional)</label>
                            <input type="file" id="component-image" class="form-control form-control-sm" accept="image/png, image/webp">
                            <div class="form-text">Max 800x400 recommended.</div>
                            <img id="image-preview" src="#" alt="Image Preview" class="img-fluid mt-2 rounded" style="max-width: 100%; display: none; border: 1px solid var(--bs-border-color);">
                        </div>
                        <hr>
                    </div>

                    <div id="elements-and-wiring" class="flex-grow-1 overflow-auto pe-2">
                        <h4 class="text-body-emphasis">Layout & Wiring</h4>
                        <div class="mb-3">
                            <div class="dropdown">
                                <button class="btn btn-outline-primary dropdown-toggle w-100" type="button" id="add-shape-menu" data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="bi bi-plus-lg me-1"></i> Add Shape
                                </button>
                                <ul class="dropdown-menu" aria-labelledby="add-shape-menu">
                                    <li><a class="dropdown-item disabled" href="#" id="add-strip-btn">Strip (Coming Soon)</a></li>
                                    <li><a class="dropdown-item" href="#" id="add-matrix-btn">Matrix (Rectangle)</a></li>
                                    <li><a class="dropdown-item disabled" href="#" id="add-circle-btn">Circle (Coming Soon)</a></li>
                                    <li>
                                        <hr class="dropdown-divider">
                                    </li>
                                    <li><a class="dropdown-item disabled" href="#" id="add-l-shape-btn">L-Shape (Coming Soon)</a></li>
                                    <li><a class="dropdown-item disabled" href="#" id="add-u-shape-btn">U-Shape (Coming Soon)</a></li>
                                    <li><a class="dropdown-item disabled" href="#" id="add-dual-circle-btn">Dual Circle (Coming Soon)</a></li>
                                    <li><a class="dropdown-item disabled" href="#" id="add-circle-cols-btn">Circle w/ Columns (Coming Soon)</a></li>
                                </ul>
                            </div>
                        </div>
                        <div id="element-list" class="mb-3">
                        </div>
                        <div id="wiring-controls">
                            <h5 class="text-body-secondary fs-6">Wiring Order</h5>
                            <button class="btn btn-sm btn-primary" id="define-wiring-btn"><i class="bi bi-vector-pen"></i> Define Order</button>
                        </div>
                    </div>

                </div>
            </div>

            <div id="right-panel" class="d-flex flex-column h-100">
                <div id="toolbar" class="bg-body-tertiary p-2 rounded d-flex flex-wrap">
                    <div class="btn-group btn-group-sm me-2 mb-1" role="group">
                        <button class="btn btn-secondary active" id="tool-select-btn" data-bs-toggle="tooltip" title="Select Tool (V)"><i class="bi bi-cursor-fill"></i></button>
                        <button class="btn btn-secondary" id="tool-place-led-btn" data-bs-toggle="tooltip" title="Place LED Tool (P)"><i class="bi bi-circle-fill"></i></button>
                        <button class="btn btn-secondary" id="tool-wiring-btn" data-bs-toggle="tooltip" title="Wiring Tool (W)"><i class="bi bi-vector-pen"></i></button>
                    </div>
                    <div class="btn-group btn-group-sm me-2 mb-1" role="group">
                        <button class="btn btn-secondary" id="zoom-in-btn" data-bs-toggle="tooltip" title="Zoom In (+)"><i class="bi bi-zoom-in"></i></button>
                        <button class="btn btn-secondary" id="zoom-out-btn" data-bs-toggle="tooltip" title="Zoom Out (-)"><i class="bi bi-zoom-out"></i></button>
                        <button class="btn btn-secondary" id="zoom-reset-btn" data-bs-toggle="tooltip" title="Reset Zoom (0)"><i class="bi bi-aspect-ratio"></i></button>
                    </div>
                    <div class="btn-group btn-group-sm me-2 mb-1" role="group">
                        <button class="btn btn-secondary" id="toggle-grid-btn" data-bs-toggle="tooltip" title="Toggle Grid (G)"><i class="bi bi-grid-3x3"></i></button>
                        <button class="btn btn-secondary" id="toggle-snap-btn" data-bs-toggle="tooltip" title="Toggle Snap (S)"><i class="bi bi-magnet-fill"></i></button>
                    </div>
                    <div class="btn-group btn-group-sm me-2 mb-1" role="group">
                        <button class="btn btn-secondary" id="undo-btn" data-bs-toggle="tooltip" title="Undo (Ctrl+Z)" disabled><i class="bi bi-arrow-counterclockwise"></i></button>
                        <button class="btn btn-secondary" id="redo-btn" data-bs-toggle="tooltip" title="Redo (Ctrl+Y)" disabled><i class="bi bi-arrow-clockwise"></i></button>
                    </div>
                </div>

                <div id="right-panel-top" class="d-flex flex-column" style="overflow: hidden; background-color: #2b3035;">
                    <div id="component-canvas-container" class="m-auto position-relative" style="width: 500px; height: 300px; border: 1px dashed grey; overflow: auto; background-color: #343a40;">
                        <canvas id="componentCanvas" width="1000" height="600"></canvas>
                    </div>
                </div>

                <div class="ms-auto ps-3 text-body-secondary d-flex align-items-center">
                    <i class="bi bi-crosshair me-2"></i>
                    <span id="coords-display" class="font-monospace" style="min-width: 100px;">---, ---</span>
                </div>
            </div>
        </div>

        <div class="toast-container position-fixed bottom-0 end-0 p-3" style="z-index: 99999">
            <div id="app-toast" class="toast border-0" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="5000" style="width: 350px; font-size: 1.1rem;">
                <div id="app-toast-header" class="toast-header text-white d-flex align-items-center">
                    <i id="app-toast-icon" class="bi me-2"></i>
                    <strong class="me-auto" id="app-toast-title">Notification</strong>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
                <div class="toast-body bg-dark" id="app-toast-body">
                </div>
            </div>
        </div>

        <div class="modal fade" id="load-project-modal" tabindex="-1">...</div>
        <div class="modal fade" id="save-project-modal" tabindex="-1">...</div>
        <div class="modal fade" id="notification-modal" tabindex="-1">...</div>
        <div class="modal fade" id="confirm-overwrite-modal" tabindex="-1">...</div>
        <div class="modal fade" id="help-modal" tabindex="-1">...</div>
        <div class="modal fade" id="about-modal" tabindex="-1">...</div>
        <div class="modal fade" id="terms-modal" tabindex="-1">...</div>
        <div class="modal fade" id="privacy-policy-modal" tabindex="-1">...</div>
        <div class="modal fade" id="accept-terms-modal" tabindex="-1">...</div>

        <div class="offcanvas offcanvas-end" tabindex="-1" id="gallery-offcanvas" aria-labelledby="galleryOffcanvasLabel" style="width: 500px;">
            <div class="offcanvas-header">
                <h5 class="offcanvas-title" id="galleryOffcanvasLabel"><i class="bi bi-folder2-open me-2"></i>Open Component</h5>
                <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
            </div>
            <div class="offcanvas-body">
                {/* --- ADD THIS DIV --- */}
                <div id="user-component-list" class="list-group">
                </div>
                {/* --- END ADDED DIV --- */}
            </div>
        </div>

        <div class="modal fade" id="share-modal" tabindex="-1">...</div>

        <div class="modal fade" id="export-component-modal" tabindex="-1" aria-labelledby="exportComponentModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exportComponentModalLabel"><i class="bi bi-filetype-json me-2"></i>Export Component</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>Your component JSON will be generated.</p>
                        <pre id="json-preview" style="max-height: 300px; overflow: auto; background-color: var(--bs-tertiary-bg); padding: 10px; border-radius: 5px;"><code>{...}</code></pre>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" id="confirm-export-json-btn"><i class="bi bi-download me-2"></i>Download .json</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="add-matrix-modal" tabindex="-1" aria-labelledby="addMatrixModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addMatrixModalLabel"><i class="bi bi-grid-3x3-gap me-2"></i>Add LED Matrix</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>A grid of LEDs will be created at the center of your view.</p>
                        <div class="row mb-3">
                            <div class="col">
                                <label for="matrix-cols" class="form-label">Columns</label>
                                <input type="number" id="matrix-cols" class="form-control" value="8" min="1">
                            </div>
                            <div class="col">
                                <label for="matrix-rows" class="form-label">Rows</label>
                                <input type="number" id="matrix-rows" class="form-control" value="8" min="1">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col">
                                <label for="matrix-wiring" class="form-label">Wiring Direction</label>
                                <select id="matrix-wiring" class="form-select">
                                    <option value="horizontal" selected>Horizontal Serpentine (Left-to-Right)</option>
                                    <option value="vertical">Vertical Serpentine (Top-to-Bottom)</option>
                                </select>
                                <div class="form-text">Determines the auto-wiring path.</div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" id="confirm-add-matrix-btn">Create Matrix</button>
                    </div>
                </div>
            </div>
        </div>

    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="util.js" type="module"></script>
    <script src="firebase.js" type="module"></script>
    <script src="canvas.js" type="module"></script>
    <script src="main.js" type="module"></script>
</body>

</html>