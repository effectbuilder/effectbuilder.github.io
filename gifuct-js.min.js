!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).gifuct={})}(this,(function(t){"use strict";const e={};function r(t){const r={};for(const n in t)r[n]=t[n];for(var i=1;i<arguments.length;i++){const t=arguments[i];for(const n in t)n in r||(r[n]=t[n])}return r}function i(t,e){const r=t.getUint16(e,!0);return t.getUint16(e+2,!0)*r}e.enumerable=!0,e.configurable=!0;const n=t=>new Promise(((e,r)=>{const i=new FileReader;i.onload=t=>e(new Uint8Array(t.target.result)),i.onerror=r,i.readAsArrayBuffer(t)}));function a(t){const e=new DataView(t.buffer);let r,i,n,a;if(1!==t[0]||46!==t[1]||112!==t[2]||105!==t[3]||120!==t[4]||101!==t[5]||108!==t[6]||32!==t[7]||109!==t[8]||97!==t[9]||112!==t[10]||32!==t[11]||116!==t[12]||111!==t[13]||32!==t[14]||103!==t[15]||105!==t[16]||102!==t[17]||56!==t[18]||57!==t[19]||97!==t[20]||10)return null;const o=e.getUint16(21,!0),s=e.getUint16(23,!0),l=e.getUint8(25),d=e.getUint8(26),u=e.getUint8(27),f=e.getUint16(28,!0),c=e.getUint16(30,!0),h=e.getUint16(32,!0);let m,g,p,v,y,w,b,A,C;return 0!==(128&l)&&(g=i(e,34)),0!==(64&l)&&(r=t.subarray(34+g,34+g+i(e,34+g))),0!==(32&l)&&(i=t.subarray(34+g+r.length,34+g+r.length+i(e,34+g+r.length))),0!==(16&l)&&(n=t.subarray(34+g+r.length+i.length,34+g+r.length+i.length+i(e,34+g+r.length+i.length))),0!==(8&l)&&(a=t.subarray(34+g+r.length+i.length+n.length,34+g+r.length+i.length+n.length+i(e,34+g+r.length+i.length+n.length))),m=34+g+r.length+i.length+n.length+a.length,{width:o,height:s,gce:0!==(128&l),colorTable:0!==(128&l)?new Uint8Array(e.buffer,34,3*Math.pow(2,1+(7&d))):void 0,image:{left:c,top:f,width:h,height:e.getUint16(m-2,!0),colorTable:0!==(128&u)?new Uint8Array(e.buffer,m,3*Math.pow(2,1+(7&u))):void 0, laced:0!==(64&u),sort:0!==(32&u),reserved:0!==(24&u),sizeOfLocalColorTable:7&u,minCodeSize:e.getUint8(m+3*Math.pow(2,1+(7&u))),pixelValues:t.subarray(m+1+3*Math.pow(2,1+(7&u)))}}}function o(t){const e=new DataView(t.buffer);let r=10;const i=128&e.getUint8(4),n=64&e.getUint8(4),a=32&e.getUint8(4),o=16&e.getUint8(4),s=7&e.getUint8(4),l=e.getUint8(5),d=e.getUint8(6);let u;return i&&(u=new Uint8Array(t.buffer,r,3*Math.pow(2,s+1)),r+=3*Math.pow(2,s+1)),{hasColorTable:i,colorTableSorted:n,colorTableSize:s,backgroundColorIndex:l,pixelAspectRatio:d,colorTable:u,frames:function(t,e){const r=[];let i=!0,n=e,a=0;for(;i;){const e=t.getUint8(n);if(59===e)i=!1;else if(33===e){const e=t.getUint8(n+1);if(249===e){const i=t.getUint8(n+3),o=t.getUint8(n+4),s=t.getUint8(n+5),l=t.getUint8(n+6),d=t.getUint8(n+7);r.push({gce:{packedFields:i,delayTime:10*(o<<8|s),transparentColorIndex:l,terminator:d},image:null})}else if(254===e);else if(255===e)a=n,n+=13+t.getUint8(n+12);else if(1===e){const e=function(t,e){let r=e;const i=t.getUint8(r);r+=1;const n=t.getUint8(r);r+=1;const a=[];if(i>0)for(let e=0;e<i;e++)a.push(t.getUint8(r)),r+=1;return{size:i,terminator:n,subBlocks:a}}(t,n);n+=2+e.size,r.push({plainText:e,image:null})}n+=1}else if(44===e){const e=function(t,e){const r=new DataView(t.buffer),i=r.getUint16(e+1,!0),n=r.getUint16(e+3,!0),a=r.getUint16(e+5,!0),o=r.getUint16(e+7,!0),s=r.getUint8(e+9),l=128&s,d=64&s,u=32&s,f=24&s,c=7&s,h=r.getUint8(e+10);let m=e+11;l&&(m+=3*Math.pow(2,c+1));const g=function(t,e){let r=e;const i=t.getUint8(r);r+=1;const n=t.getUint8(r);r+=1;const a=[];if(i>0)for(let e=0;e<i;e++){const i=t.getUint8(r);r+=1,a.push(t.subarray(r,r+i)),r+=i}return{size:i,terminator:n,subBlocks:a}}(t,m);return m+=2+g.size,{left:i,top:n,width:a,height:o,packedFields:s,hasColorTable:l,laced:d,sort:u,reserved:f,sizeOfLocalColorTable:c,minCodeSize:h,pixelValues:g.subBlocks}};if(r.length>0&&null===r[r.length-1].image){const t=r[r.length-1];t.image=e,n=e.pixelValues.reduce(((t,e)=>t+e.length),n)}else r.push({gce:null,image:e,appExtensions:[]});n+=11+3*(e.hasColorTable?Math.pow(2,e.sizeOfLocalColorTable+1):0);for(const t of e.pixelValues)n+=t.length+1;n+=1}else n+=1}return r}(t,r)}}t.decompressFrames=async function(t,e){const i=t.frames.map((r=>function(t,e,r,i){const n=t.width,a=t.height,o=new Uint8Array(n*a*4);let s,l,d,u;t.hasColorTable?(l=t.colorTable,d=l.length):e.image.hasColorTable?(l=e.image.colorTable,d=l.length):(l=r.colorTable,d=r.length),e.gce&&e.gce.packedFields.transparentColor?u=e.gce.transparentColorIndex:u=void 0;const f=e.image.minCodeSize;let c=e.image.pixelValues.reduce(((t,e)=>t.concat(Array.from(e))),[]);const h=(e,r,i)=>{o[e]=l[3*r],o[e+1]=l[3*r+1],o[e+2]=l[3*r+2],o[e+3]=i},m=new g(f);m.init();let p=0,v=0;for(s=0;v<a;){let t,r,g=m.decode(c);if(null===g){if(v<a){m.add(s),g=m.decode(c)}else break}if(g===m.clearCode)m.init(),g=m.decode(c),s=g;else if(g===m.eofCode)break;else s=g;let y=0;for(let e=0;e<m.table[g].length;e++)if(t=p%n,r=Math.floor(p/n),p++,i){const a=Math.floor(t/8),o=t%8;h(4*(t+r*n),m.table[g][e],m.table[g][e]===u?0:255),y++}else h(4*(t+r*n),m.table[g][e],m.table[g][e]===u?0:255);s=g}if(e)return r(e,{patch:o});const w={dims:{top:e.image.top,left:e.image.left,width:n,height:a},colorTable:l,delay:e.gce?e.gce.delayTime:0,transparentIndex:u,disposalType:e.gce?e.gce.packedFields.disposal:0,patch:o};return r(e,w)}));return Promise.all(i)},t.parseGIF=async t=>{const e=new Uint8Array(t);return o(e)};class s{constructor(t,e,r,i,n,a,o){this.top=t,this.left=e,this.width=r,this.height=i,this.hasColorTable=n,this.laced=a,this.sort=o}}class l{constructor(t,e,r,i,n){this.transparent=t,this.userInput=e,this.disposal=r,this.delayTime=i,this.transparentColorIndex=n}}class d{constructor(t,e,r,i){this.data=t,this.left=e,this.top=r,this.width=i}}class u{constructor(t,e,r,i){this.data=t,this.left=e,this.top=r,this.width=i}}class f{constructor(t,e,r,i){this.left=t,this.top=e,this.width=r,this.height=i}}class c{constructor(t,e,r,i,n){this.size=t,this.terminator=e,this.applicationIdentifier=r,this.authenticationCode=i,this.subBlocks=n}}class h{constructor(t,e,r){this.size=t,this.terminator=e,this.subBlocks=r}}class m{constructor(t,e,r){this.size=t,this.terminator=e,this.subBlocks=r}}class g{constructor(t){const e=1<<t;this.minCodeSize=t,this.clearCode=e,this.eofCode=e+1,this.table,this.codeSize}decode(t){const e=this.table[t];return null===e?null:(this.add(e),t)}add(t){this.table[this.table.length]=t}init(){this.codeSize=this.minCodeSize+1,this.table=new Array(4106);for(let t=0;t<Math.pow(2,this.minCodeSize);t++)this.table[t]=[t];for(let t=0;t<2;t++)this.table[Math.pow(2,this.minCodeSize)+t]=null}}Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=gifuct-js.min.js.map