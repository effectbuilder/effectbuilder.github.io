<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SRGB Interactive Effect Builder</title>
    <meta property="og:title" content="SRGB Interactive Effect Builder">
    <meta property="og:description" content="A tool for creating and sharing visual effects for SignalRGB.">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://joseamirandavelez.github.io/EffectBuilder/logo.png">
    <meta name="twitter:card" content="summary_large_image">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jaames/iro@5"></script>
    <script type="module" src="firebase.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-WS7MGSDJSB"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-WS7MGSDJSB');
</script>

<body class="d-flex flex-column vh-100">
    <nav class="navbar navbar-expand-lg bg-body-tertiary">
        <div class="container-fluid">
            <a class="navbar-brand d-flex align-items-center" href="./">
                <img src="logo.png" alt="Effect Builder Logo" class="me-2" style="height: 1.5em;">
                SRGB Interactive Effect Builder
            </a>

            <div class="ms-auto d-flex align-items-center">

                <div class="btn-group me-3" role="group" aria-label="Project management actions">
                    <button class="btn btn-primary" id="new-ws-btn" data-bs-toggle="tooltip" title="New Workspace"><i class="bi bi-file-earmark-plus me-1"></i> New</button>
                    <button class="btn btn-primary" id="save-ws-btn" data-bs-toggle="tooltip" title="Save current workspace to the cloud" disabled><i class="bi bi-cloud-arrow-up me-1"></i> Save</button>
                    <button class="btn btn-primary" id="load-ws-btn" data-bs-toggle="offcanvas" data-bs-target="#gallery-offcanvas" aria-controls="gallery-offcanvas" title="Load one of your saved projects" disabled><i class="bi bi-folder2-open me-1"></i> Open</button>
                    <button class="btn btn-secondary" id="share-btn" data-bs-toggle="tooltip" title="Get a shareable link to this effect" disabled><i class="bi bi-share me-1"></i> Share</button>
                    <button class="btn btn-secondary" id="export-btn" data-bs-toggle="modal" data-bs-target="#export-options-modal" title="Download complete HTML file"> <i class="bi bi-download me-1"></i> Export </button>
                    <button class="btn btn-secondary" id="generate-srgb-link-btn" data-bs-toggle="tooltip" title="Generate SignalRGB Link. Only works if the effect is already installed."><i class="bi bi-link-45deg"></i>Import to SignalRGB</button>
                </div>
                <div class="btn-group me-3" role="group" aria-label="Community">
                    <a href="./gallery.html" class="btn btn-primary" title="Browse the Community Gallery"><i class="bi bi-view-list me-1"></i> Community Gallery</a>
                    <a href="./showcase.html" class="btn btn-primary" title="Browse the Effect Showcase page"> <i class="bi bi-view-list me-1"></i> Effect Showcase </a>
                </div>
                <div class="btn-group me-3" role="group" aria-label="Editor">
                    <a href="./builder" class="btn btn-dark" title="Component Builder"><i class="bi bi-view-list me-1"></i> Component Builder</a>
                </div>
                <input type="file" id="effect-file-input" style="display: none;" accept=".html, .htm">

                <div class="btn-group me-3" role="group" aria-label="Help and settings">
                    <button class="btn btn-secondary" id="help-btn" data-bs-toggle="modal" data-bs-target="#help-modal" title="Help"><i class="bi bi-question-circle"></i></button>
                    <button class="btn btn-secondary" id="about-btn" data-bs-toggle="modal" data-bs-target="#about-modal" title="About"><i class="bi bi-info-circle"></i></button>
                    <a class="btn btn-secondary" id="contact-btn" href="https://github.com/effectbuilder/effectbuilder.github.io/issues/new/choose" target="_blank" rel="noopener" title="Report Bug / Request Feature on GitHub">
                        <i class="bi bi-github"></i>
                    </a>
                    <button class="btn btn-secondary" type="button" id="theme-switcher-btn" title="Change Theme">
                        <i class="bi" id="theme-icon"></i>
                    </button>
                </div>

                <div id="auth-notification-block" class="d-flex align-items-center">

                    <button class="btn btn-success" id="login-btn"><i class="bi bi-google me-2"></i>Sign In</button>

                    <div class="btn-group d-none" id="user-session-group" role="group" aria-label="User actions">

                        <div class="btn-group" role="group">
                            <button class="btn btn-info dropdown-toggle position-relative" type="button" id="notification-dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="bi bi-bell"></i>
                                <span id="notification-badge" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger d-none">
                                    0
                                    <span class="visually-hidden">new notifications</span>
                                </span>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end dropdown-menu-dark p-2" aria-labelledby="notification-dropdown-toggle" style="min-width: 300px;">
                                <li class="dropdown-header d-flex justify-content-between align-items-center">
                                    <strong>Notifications</strong>
                                    <button class="btn btn-sm btn-link text-info p-0" id="mark-all-read-btn">Mark All Read</button>
                                </li>
                                <li>
                                    <hr class="dropdown-divider">
                                </li>
                                <div id="notification-list-container" style="max-height: 400px; overflow-y: auto;">
                                </div>
                            </ul>
                        </div>

                        <span class="btn btn-secondary d-flex align-items-center disabled" style="pointer-events: none;">
                            <img id="user-photo" class="rounded-circle me-2" style="width: 24px; height: 24px;" alt="User profile photo">
                            <span id="user-display"></span>
                        </span>

                        <button class="btn btn-danger" id="logout-btn" title="Sign Out"><i class="bi bi-box-arrow-right"></i></button>
                    </div>

                </div>
            </div>
        </div>
    </nav>

    <div class="container-fluid flex-grow-1 overflow-hidden p-0">
        <div class="h-100" id="main-split">
            <div id="left-panel" class="h-100 p-3 border-end bg-body-tertiary" style="overflow: auto;">
                <div class="h-100 d-flex flex-column">
                    <div class="flex-grow-1 overflow-auto pe-2">
                        <h4 class="text-body-emphasis">Controls</h4>
                        <form id="controls-form"></form>
                    </div>
                    <div class="mt-3 d-flex gap-2">
                        <button class="btn btn-success w-100" id="add-object-btn" data-bs-toggle="tooltip" title="Add a new default object to the scene"><i class="bi bi-plus-circle"></i> Add Object</button>
                        <button class="btn btn-primary w-100" id="add-polyline-btn" data-bs-toggle="tooltip" title="Draw a new polyline"><i class="bi bi-pen"></i> Add Polyline</button>
                    </div>
                </div>
            </div>

            <div id="right-panel" class="d-flex flex-column h-100">
                <div id="toolbar" class="bg-body-tertiary p-2 rounded d-flex flex-wrap">
                    <div class="btn-group btn-group-sm me-2 mb-1" role="group" aria-label="History actions">
                        <button class="btn btn-secondary" id="undo-btn" data-bs-toggle="tooltip" title="Undo (Ctrl+Z)" disabled><i class="bi bi-arrow-counterclockwise"></i></button>
                        <button class="btn btn-secondary" id="redo-btn" data-bs-toggle="tooltip" title="Redo (Ctrl+Y)" disabled><i class="bi bi-arrow-clockwise"></i></button>
                    </div>
                    <div class="btn-group btn-group-sm me-2 mb-1" role="group">
                        <button type="button" class="btn btn-secondary" id="copy-props-btn" data-bs-toggle="tooltip" title="Copy Properties"><i class="bi bi-clipboard-plus"></i></button>
                        <button type="button" class="btn btn-secondary" id="paste-props-btn" data-bs-toggle="tooltip" title="Paste Properties" disabled><i class="bi bi-clipboard-check"></i></button>
                    </div>
                    <div class="btn-group btn-group-sm me-2 mb-1" role="group">
                        <button type="button" class="btn btn-secondary" data-action="align-screen-left" data-bs-toggle="tooltip" title="Align Left to Screen"><i class="bi bi-align-start"></i></button>
                        <button type="button" class="btn btn-secondary" data-action="align-screen-h-center" data-bs-toggle="tooltip" title="Align Horizontal Center to Screen"><i class="bi bi-align-center"></i></button>
                        <button type="button" class="btn btn-secondary" data-action="align-screen-right" data-bs-toggle="tooltip" title="Align Right to Screen"><i class="bi bi-align-end"></i></button>
                    </div>
                    <div class="btn-group btn-group-sm me-2 mb-1" role="group">
                        <button type="button" class="btn btn-secondary" data-action="align-screen-top" data-bs-toggle="tooltip" title="Align Top to Screen"><i class="bi bi-align-top"></i></button>
                        <button type="button" class="btn btn-secondary" data-action="align-screen-v-center" data-bs-toggle="tooltip" title="Align Vertical Center to Screen"><i class="bi bi-align-middle"></i></button>
                        <button type="button" class="btn btn-secondary" data-action="align-screen-bottom" data-bs-toggle="tooltip" title="Align Bottom to Screen"><i class="bi bi-align-bottom"></i></button>
                    </div>
                    <div class="btn-group btn-group-sm me-2 mb-1" role="group">
                        <button type="button" class="btn btn-secondary" data-action="match-width" data-bs-toggle="tooltip" title="Match Width of First Selected"><i class="bi bi-arrows-expand-vertical"></i> W</button>
                        <button type="button" class="btn btn-secondary" data-action="match-height" data-bs-toggle="tooltip" title="Match Height of First Selected"><i class="bi bi-arrows-expand"></i> H</button>
                        <button type="button" class="btn btn-secondary" data-action="match-both" data-bs-toggle="tooltip" title="Match Size of First Selected"><i class="bi bi-fullscreen"></i></button>
                        <button type="button" class="btn btn-secondary" data-action="fit-canvas" data-bs-toggle="tooltip" title="Fit to Canvas"><i class="bi bi-arrows-fullscreen"></i></button>
                    </div>
                    <div class="btn-group btn-group-sm me-2 mb-1" role="group">
                        <button type="button" class="btn btn-secondary" id="constrain-btn" data-bs-toggle="tooltip" title="Snap to Canvas"><i class="bi bi-magnet-fill"></i></button>
                        <button type="button" class="btn btn-secondary" id="match-text-size-btn" data-action="match-text-size" data-bs-toggle="tooltip" title="Match Text Size to Cell Height" disabled><i class="bi bi-fonts"></i> <i class="bi bi-grid-3x3"></i></button>
                        <button id="startAudioBtn" class="btn btn-primary">Start Listening</button>
                    </div>
                </div>
                <div id="right-panel-top" class="d-flex flex-column" style="overflow: auto; min-height: 0;">
                    <div id="canvas-container" class="mx-auto">
                        <canvas id="signalCanvas"></canvas>
                    </div>
                </div>
                <div class="ms-auto ps-3 text-body-secondary d-flex align-items-center">
                    <i class="bi bi-crosshair me-2"></i>
                    <span id="coords-display" class="font-monospace" style="min-width: 100px;">---, ---</span>
                </div>

                <hr>

                <div class="d-flex align-items-center px-4">
                    <button class="btn btn-sm btn-outline-danger" id="like-effect-btn" data-bs-toggle="tooltip" title="Like this effect" disabled>
                        <i class="bi bi-heart"></i>
                        <span id="like-effect-btn-label">Like</span>
                        <span id="like-count-display" class="badge bg-danger ms-2" style="display: none; font-size: 0.9em;">0</span>
                    </button>
                </div>
                <div id="component-comments-section" class="m-4">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h4 class="text-body-emphasis mb-0">Comments</h4>
                        <button class="btn btn-sm btn-outline-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#comment-collapse-wrapper" aria-expanded="true" aria-controls="comment-collapse-wrapper" title="Toggle Comments">
                            <i class="bi bi-chevron-up"></i>
                        </button>
                    </div>

                    <div class="collapse show" id="comment-collapse-wrapper">
                        <div class="alert alert-info small p-2" role="alert">
                            <i class="bi bi-info-circle me-1"></i> Comments are public. Please be respectful and courteous.
                        </div>
                        <div id="comment-list" class="pe-2 mb-3" style="max-height: 400px; overflow-y: auto;">
                            <p id="comments-loading-placeholder" class="text-muted" style="display: none;">
                                <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                                Loading comments...
                            </p>
                            <p id="comments-save-prompt" class="text-muted" style="display: none;">
                                Save this component to the cloud to enable comments.
                            </p>
                        </div>

                        <form id="comment-form" class="pe-2" style="display: none;">
                            <div class="mb-2">
                                <label for="comment-textarea" class="form-label form-label-sm">Add a comment</label>
                                <textarea id="comment-textarea" class="form-control form-control-sm" rows="3" placeholder="Write your comment..." required></textarea>
                            </div>
                            <button id="comment-submit-btn" type="submit" class="btn btn-primary btn-sm">
                                <i class="bi bi-send me-1"></i> Post Comment
                            </button>
                        </form>

                        <div id="comment-login-prompt" class="alert alert-info" style="display: none;">
                            Please <a href="#" id="comment-login-link">sign in</a> to post a comment.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="toast-container position-fixed bottom-0 end-0 p-3" style="z-index: 99999">
            <div id="app-toast" class="toast border-0" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="5000" style="width: 350px; font-size: 1.1rem;">
                <div id="app-toast-header" class="toast-header text-white d-flex align-items-center">
                    <i id="app-toast-icon" class="bi me-2"></i>
                    <strong class="me-auto" id="app-toast-title">Notification</strong>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
                <div class="toast-body bg-dark" id="app-toast-body">
                </div>
            </div>
        </div>

        <div class="modal fade" id="load-project-modal" tabindex="-1" aria-labelledby="loadProjectModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="loadProjectModalLabel">Load Project</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>Select a project to load. This will overwrite your current workspace.</p>
                        <ul class="list-group" id="load-project-list"></ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="save-project-modal" tabindex="-1" aria-labelledby="saveProjectModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="saveProjectModalLabel">Save Project</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="save-project-name-input" class="form-label">Project Name:</label>
                            <input type="text" class="form-control" id="save-project-name-input" placeholder="Enter a name for your project...">
                        </div>
                        <hr>
                        <p>Existing Projects:</p>
                        <ul class="list-group" id="save-project-existing-list">
                        </ul>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" id="confirm-save-btn">Save Project</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="notification-modal" tabindex="-1" aria-labelledby="notificationModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="notificationModalLabel">Success</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body" id="notification-modal-body">
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">OK</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="confirm-overwrite-modal" tabindex="-1" aria-labelledby="confirmOverwriteModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="confirmOverwriteModalLabel">Confirm Overwrite</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body" id="confirm-overwrite-modal-body">
                        A project with this name already exists. Do you want to overwrite it?
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-danger" id="confirm-overwrite-btn">Overwrite</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="help-modal" tabindex="-1" aria-labelledby="helpModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-lg modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title me-auto" id="helpModalLabel"><i class="bi bi-question-circle me-2"></i>How to Use the Effect Builder</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>Welcome to the SRGB Interactive Effect Builder! This guide explains the features to help you create stunning visual effects.</p>

                        <div class="ratio ratio-16x9 mb-4">
                            <iframe src="https://www.youtube.com/embed/KSasPw0HScc?si=vCThireMBH0jnnHj" title="SRGB Interactive Effect Builder" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
                        </div>

                        <div class="accordion" id="help-accordion">

                            <div class="accordion-item">
                                <h2 class="accordion-header" id="help-heading-1">
                                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#help-collapse-1" aria-expanded="true" aria-controls="help-collapse-1">
                                        <i class="bi bi-layout-split me-2"></i> Interface Overview
                                    </button>
                                </h2>
                                <div id="help-collapse-1" class="accordion-collapse collapse show" aria-labelledby="help-heading-1">
                                    <div class="accordion-body">
                                        <p>The builder is divided into two main panels:</p>
                                        <ul>
                                            <li>The <strong>Controls Panel</strong> on the left is where you manage all the objects and global settings for your effect.</li>
                                            <li>The <strong>Canvas Panel</strong> on the right contains the visual editor and the main <strong>Toolbar</strong>.</li>
                                        </ul>
                                        <hr>
                                        <h6>Controls Panel (Left)</h6>
                                        <p>Each object gets its own collapsible panel containing tabbed sections for its properties (e.g., Geometry, Fill-Animation, Stroke). You can perform several actions on these panels:</p>
                                        <ul>
                                            <li><strong>Rename:</strong> Click the object's name (e.g., "Object 1") to edit it.</li>
                                            <li><strong>Reorder:</strong> Click and drag the <i class="bi bi-grip-vertical"></i> icon to change the rendering order (layering).</li>
                                            <li><strong>Lock/Unlock:</strong> Use the <i class="bi bi-unlock-fill"></i> / <i class="bi bi-lock-fill"></i> button to prevent an object from being moved on the canvas.</li>
                                            <li><strong>Duplicate/Delete:</strong> Use the menu button (<i class="bi bi-list"></i>) to access options for duplicating or deleting an object.</li>
                                        </ul>
                                        <p>Use the <strong>Global Overrides</strong> in the "General Settings" panel to apply a master color palette or color cycle effect to all objects at once.</p>
                                    </div>
                                </div>
                            </div>

                            <div class="accordion-item">
                                <h2 class="accordion-header" id="help-heading-2">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#help-collapse-2" aria-expanded="false" aria-controls="help-collapse-2">
                                        <i class="bi bi-easel2-fill me-2"></i> The Canvas & Toolbar
                                    </button>
                                </h2>
                                <div id="help-collapse-2" class="accordion-collapse collapse" aria-labelledby="help-heading-2">
                                    <div class="accordion-body">
                                        <h6>Canvas Interaction</h6>
                                        <ul>
                                            <li><strong>Select:</strong> Click an object to select it. Hold <kbd>Shift</kbd> or <kbd>Ctrl</kbd> to select multiple objects.</li>
                                            <li><strong>Manipulate:</strong> Drag a selected object to move it, drag its square handles to resize, or drag its circular handle to rotate.</li>
                                            <li><strong>Snapping:</strong> Objects will automatically snap to the edges and centers of other objects and the canvas for easy alignment.</li>
                                        </ul>
                                        <hr>
                                        <h6>Toolbar</h6>
                                        <p>The toolbar above the canvas provides quick access to powerful tools:</p>
                                        <ul>
                                            <li><strong>History (<i class="bi bi-arrow-counterclockwise"></i> / <i class="bi bi-arrow-clockwise"></i>):</strong> Undo and Redo your recent changes.</li>
                                            <li><strong>Copy/Paste Properties (<i class="bi bi-clipboard-plus"></i> / <i class="bi bi-clipboard-check"></i>):</strong> Copy property groups (like size, color, animation) from one object and paste them onto others.</li>
                                            <li><strong>Alignment & Matching:</strong> With object(s) selected, you can align them to the screen, match their sizes, or fit them to the canvas instantly.</li>
                                            <li><strong>Constrain to Canvas:</strong> Toggle whether objects are allowed to be moved or resized outside the canvas boundaries.</li>
                                        </ul>
                                        <hr>
                                        <h6>Keyboard Shortcuts</h6>
                                        <ul>
                                            <li><kbd>Arrow Keys</kbd>: Nudge selected objects by a small amount.</li>
                                            <li><kbd>Shift</kbd> + <kbd>Arrow Keys</kbd>: Nudge in larger steps.</li>
                                            <li><kbd>Delete</kbd> / <kbd>Backspace</kbd>: Delete selected objects.</li>
                                            <li><kbd>Ctrl/Cmd</kbd> + <kbd>Z</kbd> / <kbd>Y</kbd>: Undo and Redo.</li>
                                            <li><kbd>Ctrl/Cmd</kbd> + <kbd>C</kbd> / <kbd>V</kbd>: Copy/Paste properties.</li>
                                            <li><kbd>Escape</kbd>: Deselect all objects.</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <div class="accordion-item">
                                <h2 class="accordion-header" id="help-heading-3">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#help-collapse-3" aria-expanded="false" aria-controls="help-collapse-3">
                                        <i class="bi bi-stars me-2"></i> Advanced Shapes & Tools
                                    </button>
                                </h2>
                                <div id="help-collapse-3" class="accordion-collapse collapse" aria-labelledby="help-heading-3">
                                    <div class="accordion-body">
                                        <p>The real power of the builder lies in its specialized shapes and tools. When you change an object's <strong>Shape</strong> property, different settings will appear.</p>
                                        <h6>The Polyline Tool</h6>
                                        <ul>
                                            <li><strong>Drawing:</strong> Click the <strong><i class="bi bi-pen"></i> Add Polyline</strong> button. Click on the canvas to place points, then <strong>Double-click</strong> or press <kbd>Enter</kbd> to finish.</li>
                                            <li><strong>Editing Nodes:</strong> After creating a polyline, select it and drag its nodes. <strong>Double-click</strong> a line segment to add a node, or <strong>Alt+Click</strong> a node to delete it.</li>
                                            <li><strong>Path Animation:</strong> Animate a sub-object (particle) that travels along the path. You can customize its shape, speed, trail, and how it behaves when it reaches the end.</li>
                                        </ul>
                                        <hr>
                                        <h6>The Pixel Art Editor</h6>
                                        <ul>
                                            <li><strong>Editing:</strong> On a `pixel-art` object, click the <kbd><i class="bi bi-pencil-square"></i> Edit</kbd> button on any frame to open the built-in editor.</li>
                                            <li><strong>Tools:</strong> Use the editor's tools to paint, <kbd><i class="bi bi-paint-bucket"></i> Fill</kbd> areas, or <kbd><i class="bi bi-arrow-left-right"></i></kbd> / <kbd><i class="bi bi-arrow-down-up"></i></kbd> flip your art.</li>
                                            <li><strong>Special Colors:</strong> Use the editor's palette to paint with special values that are interpreted by the renderer, like forcing a pixel to be opaque White (1.0), the object's Color 1 (0.3), or Color 2 (0.4).</li>
                                        </ul>
                                        <hr>
                                        <h6>Importing Spritesheets & GIFs</h6>
                                        <ul>
                                            <li><strong>Paste from Clipboard:</strong> You can quickly paste an image or GIF from your clipboard directly into a `pixel-art` object. Press <kbd>Ctrl</kbd>+<kbd>V</kbd> when a pixel art object is selected to open the paste menu.</li>
                                            <li><strong>Sprite Sheets:</strong> A sprite sheet is a single image file containing a sequence of animation frames. The tool will automatically split the image into individual frames based on the frame dimensions you provide.</li>
                                            <li><strong>GIF Upload:</strong> Click the <kbd><i class="bi bi-film"></i> Upload GIF</kbd> button in the object's settings to process an animated GIF file into a series of frames.</li>
                                        </ul>
                                        <hr>
                                        <h6>The Pixel Art Gallery</h6>
                                        <ul>
                                            <li><strong>Access:</strong> On a `pixel-art` object, click the <kbd><i class="bi bi-images"></i> Browse Gallery</kbd> button in the "Pixel Art" tab to open the community gallery.</li>
                                            <li><strong>Functionality:</strong> Browse and search for pixel art from public community effects.</li>
                                            <li><strong>Usage:</strong> Clicking <kbd><i class="bi bi-plus-lg me-1"></i> Insert</kbd> on an item will append its animation frames to your currently selected `pixel-art` object.</li>
                                        </ul>
                                        <hr>
                                        <h6>Other Shapes</h6>
                                        <p>Explore other shapes like the <strong>Spawner</strong>, <strong>Strimer</strong>, and <strong>Audio Visualizer</strong>, each with their own unique set of properties to discover.</p>
                                        <ul>
                                            <li><strong>Spawner:</strong> A particle system that generates shapes and text with customizable physics like gravity, speed, rotation, and trails. You can even use a custom SVG path for the particle shape.</li>
                                            <li><strong>Strimer:</strong> Creates a dynamic effect of blocks moving in columns, designed to simulate animated cables or other vertical elements. Features include various animations like 'Bounce' or a 'Snake' effect.</li>
                                            <li><strong>Audio Visualizer:</strong> Renders audio data as bars or a line. You can choose from linear, circular, or polyline layouts and customize the number of bars, spacing, and smoothing.</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <div class="accordion-item">
                                <h2 class="accordion-header" id="help-heading-4">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#help-collapse-4" aria-expanded="false" aria-controls="help-collapse-4">
                                        <i class="bi bi-soundwave me-2"></i> Audio & Sensor Reactivity
                                    </button>
                                </h2>
                                <div id="help-collapse-4" class="accordion-collapse collapse" aria-labelledby="help-heading-4">
                                    <div class="accordion-body">
                                        <p>Make your effects dynamic by enabling reactivity in an object's <strong>Audio</strong> or <strong>Sensor</strong> tabs.</p>
                                        <ul>
                                            <li><strong>Audio Reactivity:</strong> To preview, click the <strong>Start Listening</strong> button on the toolbar and share the audio from another browser tab.</li>
                                            <li><strong>Sensor Reactivity:</strong> Create effects that respond to real-time data like CPU load. You can turn an object into a <strong>Sensor Meter</strong> (a filling bar) or a <strong>Time Plot</strong> (a real-time graph).</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <div class="accordion-item">
                                <h2 class="accordion-header" id="help-heading-5">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#help-collapse-5" aria-expanded="false" aria-controls="help-collapse-5">
                                        <i class="bi bi-box-arrow-up-right me-2"></i> Saving, Loading & Exporting
                                    </button>
                                </h2>
                                <div id="help-collapse-5" class="accordion-collapse collapse" aria-labelledby="help-heading-5">
                                    <div class="accordion-body">
                                        <ul>
                                            <li><kbd><i class="bi bi-cloud-arrow-up"></i> Save</kbd>: Saves your current project to your "My Projects" gallery in the cloud. You must be signed in.</li>
                                            <li><kbd><i class="bi bi-folder2-open"></i> Open</kbd>: Opens the gallery panel to load one of your saved projects.</li>
                                            <li><kbd><i class="bi bi-view-list"></i> Community Gallery</kbd>: Opens the gallery panel to browse public effects from all users.</li>
                                            <li><kbd><i class="bi bi-upload"></i> Upload</kbd>: Load an effect from a `.html` file from your computer.</li>
                                            <li><kbd><i class="bi bi-download"></i> Export</kbd>: Generates a <strong>.zip file</strong> containing your effect and a thumbnail, ready to be imported into SignalRGB.</li>
                                            <li><kbd><i class="bi bi-share"></i> Share</kbd>: Saves your project and generates a unique URL that can be opened by other Effect Builder users.</li>
                                            <li><kbd><i class="bi bi-link-45deg"></i> Import to SignalRGB</kbd>: Creates a special link to apply your effect's settings to an *already installed* effect in SignalRGB.</li>
                                        </ul>
                                        <hr>
                                        <h6>Export Presets</h6>
                                        <p>When you click the <kbd><i class="bi bi-download"></i> Export</kbd> button, the "Export Properties" modal allows you to decide which properties a user can change in SignalRGB. Unchecked properties will be hardcoded with the value you set in the builder. The preset buttons help you quickly select common configurations:</p>
                                        <ul>
                                            <li><strong>Expose All / Hardcode All:</strong> These buttons provide a quick way to check or uncheck every single property for all objects.</li>
                                            <li><strong>Minimal (User-Friendly):</strong> Selects only the most common properties (like a main color gradient and master speed), hiding more complex options from the end-user.</li>
                                            <li><strong>Static (No Animation):</strong> Selects all properties *except* for those related to speed and animation, creating a non-moving effect.</li>
                                            <li><strong>Animation / Colors / Geometry / Gradients:</strong> These presets select logical groups of properties, allowing you to quickly expose only the controls relevant to that category.</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <div class="accordion-item">
                                <h2 class="accordion-header" id="help-heading-6">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#help-collapse-6" aria-expanded="false" aria-controls="help-collapse-6">
                                        <i class="bi bi-box-arrow-in-down me-2"></i> Installing Custom Effects in SignalRGB
                                    </button>
                                </h2>
                                <div id="help-collapse-6" class="accordion-collapse collapse" aria-labelledby="help-heading-6">
                                    <div class="accordion-body bg-dark-subtle rounded p-3">
                                        <p class="lead">Once you've exported an effect (via the <strong>Export</strong> button), follow these steps to install it in SignalRGB:</p>
                                        <ol class="list-group list-group-numbered">
                                            <li class="list-group-item d-flex justify-content-between align-items-start bg-transparent">
                                                <div class="ms-2 me-auto">
                                                    <div class="fw-bold">Download the Effect Files</div>
                                                    Click the <span class="badge text-bg-success py-2"><i class="bi bi-download me-1"></i> Zip</span> button for the effect you want to install and download the archive file. Inside, you'll find the <code class="bg-light-subtle text-body-secondary p-1 rounded">.html</code> file and its <code class="bg-light-subtle text-body-secondary p-1 rounded">.png</code> preview.
                                                </div>
                                            </li>
                                            <li class="list-group-item d-flex justify-content-between align-items-start bg-transparent">
                                                <div class="ms-2 me-auto">
                                                    <div class="fw-bold">Locate the Custom Effects Folder</div>
                                                    Navigate to the correct folder on your PC. <strong>The path depends on your setup (especially if you use OneDrive or a custom installation).</strong> You may need to enable "Show hidden files" in your Windows Explorer settings.

                                                    <h6 class="mt-3 mb-1">Common Locations (try these in order):</h6>
                                                    <p class="mb-1 fw-medium text-info">1. Standard Documents Location:</p>
                                                    <code class="d-block p-2 bg-dark rounded text-white small">%userprofile%\Documents\WhirlwindFX\Effects\</code>

                                                    <p class="mb-1 fw-medium text-info mt-2">2. OneDrive Sync Location (for users with OneDrive):</p>
                                                    <code class="d-block p-2 bg-dark rounded text-white small">C:\Users\<span class="text-warning">&lt;YOUR_USERNAME&gt;</span>\OneDrive\Documents\WhirlwindFX\Effects\</code>
                                                </div>
                                            </li>
                                            <li class="list-group-item d-flex justify-content-between align-items-start bg-transparent">
                                                <div class="ms-2 me-auto">
                                                    <div class="fw-bold">Copy the Files</div>
                                                    Place both the <strong><code class="bg-light-subtle text-body-secondary p-1 rounded">.html</code> effect file</strong> and the <strong><code class="bg-light-subtle text-body-secondary p-1 rounded">.png</code> preview image</strong> directly into the correct effects folder.
                                                </div>
                                            </li>
                                            <li class="list-group-item d-flex justify-content-between align-items-start bg-transparent">
                                                <div class="ms-2 me-auto">
                                                    <div class="fw-bold">Restart SignalRGB</div>
                                                    The SignalRGB application must be <strong>restarted</strong> to detect the new effect file.
                                                </div>
                                            </li>
                                            <li class="list-group-item d-flex justify-content-between align-items-start bg-transparent">
                                                <div class="ms-2 me-auto">
                                                    <div class="fw-bold">Apply the Effect</div>
                                                    The new effect will now appear in the <strong>Installed</strong> section of the SignalRGB Library, ready for you to use!
                                                </div>
                                            </li>
                                        </ol>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Got it!</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="about-modal" tabindex="-1" aria-labelledby="aboutModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="aboutModalLabel">About Effect Builder</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p><strong>SRGB Effect Builder</strong> is a web-based visual tool designed to simplify the creation of complex animated effects for the <a href="https://signalrgb.com/" target="_blank">SignalRGB</a> platform.</p>
                        <p>Built by José A. Miranda Vélez in the beautiful island of Puerto Rico, this project aims to provide an intuitive, WYSIWYG interface for designers and enthusiasts to bring their ideas to life without needing to write code from scratch.</p>
                        <ul class="list-group">
                            <li class="list-group-item">
                                <strong>Version:</strong> <span id="version-display">1.0</span>
                            </li>
                            <li class="list-group-item">
                                <strong>Project Home:</strong> <a href="https://github.com/effectbuilder/effectbuilder.github.io" target="_blank">View on GitHub</a>
                            </li>
                            <li class="list-group-item">
                                <strong>Terms & Privacy:</strong>
                                <a href="#" data-bs-toggle="modal" data-bs-target="#terms-modal" data-bs-dismiss="modal">Terms of Usage</a> |
                                <a href="#" data-bs-toggle="modal" data-bs-target="#privacy-policy-modal" data-bs-dismiss="modal">Privacy Policy</a>
                            </li>
                        </ul>
                        <h6 class="mt-4">Credits & Inspirations</h6>
                        <p>This tool stands on the shoulders of giants. Special thanks to the creators of the external <a href="https://pixelart.nolliergb.com/" target="_blank">Pixel Art Data Generator</a>, which inspired the built-in pixel editor.</p>

                        <h6 class="mt-4">For Developers & Contributors</h6>
                        <p>This is an open-source project. If you're interested in contributing or learning how to add new shapes and properties, please see the project's <a href="https://github.com/effectbuilder/effectbuilder.github.io" target="_blank">README on GitHub</a> for a technical guide.</p>

                    </div>
                    <div class="modal-footer">
                        <div class="text-muted small me-auto">© 2025 José A. Miranda Vélez. All Rights Reserved.</div>
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="terms-modal" tabindex="-1" aria-labelledby="termsModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="termsModalLabel">Terms of Usage</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>By using this Interactive Effect Builder (the "Tool"), you agree to the following terms:</p>

                        <h6 class="mt-4">1. No Warranty</h6>
                        <p>This Tool is provided "as-is", without any warranties of any kind, express or implied. The
                            developer makes no guarantees regarding its functionality, reliability, or suitability for any
                            particular purpose.</p>

                        <h6 class="mt-4">2. Limitation of Liability</h6>
                        <p>In no event shall the developer be liable for any claim, damages, or other liability arising from
                            the use of, or inability to use, the Tool.</p>

                        <h6 class="mt-4">3. User Responsibility</h6>
                        <p>You are solely responsible for the effects you create and their use. It is your responsibility to
                            ensure they comply with the terms of service of any platform or application they are used with,
                            including SignalRGB.</p>

                        <h6 class="mt-4">4. Content Disclaimer</h6>
                        <p>The developer is not responsible for any content, including effects, created or shared by users of this Tool. Some user-generated effects may be inappropriate or unsuitable for certain audiences. Use caution when sharing or loading effects from others.</p>

                        <h6 class="mt-4">5. License</h6>
                        <p>This project is licensed under the GNU General Public License v3.0. You may copy, distribute and modify the software as long as you track changes/dates in source files and keep modifications under the same license. The software is provided "as is", without warranty of any kind. For the full license text, please see the <a href="https://www.gnu.org/licenses/gpl-3.0.html" target="_blank">official GNU GPLv3 page</a>.</p>

                        <h6 class="mt-4">6. Public Content and Licensing</h6>
                        <p>By saving or sharing an effect, you are making it public. You grant a perpetual, worldwide, non-exclusive, royalty-free license to other users and to this website to use, display, reproduce, and distribute your created effect. This allows features like the Community Gallery to function.</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" id="accept-terms2-btn" data-bs-dismiss="modal">I Accept</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="privacy-policy-modal" tabindex="-1" aria-labelledby="privacyPolicyModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="privacyPolicyModalLabel">Privacy Policy</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p><em>Last Updated: September 21, 2025</em></p>
                        <p>This Privacy Policy describes how we handle information in the SRGB Interactive Effect Builder (the "Tool").</p>

                        <h6 class="mt-4">Information We Collect</h6>
                        <ul>
                            <li><strong>Account Information:</strong> If you choose to sign in with Google, we collect your public profile information, including your name, photo, and unique user ID.</li>
                            <li><strong>User-Generated Content:</strong> We collect the effects you save to the cloud, which includes all configuration data, names, and descriptions you provide.</li>
                            <li><strong>Browser Storage:</strong> The Tool uses your browser's `localStorage` to remember that you have accepted the Terms of Usage, so you are not prompted on every visit.</li>
                        </ul>

                        <h6 class="mt-4">How We Use Information</h6>
                        <ul>
                            <li>To associate your saved effects with your user profile.</li>
                            <li>To display your public display name and profile photo next to your creations in the Community Gallery.</li>
                            <li>To operate and maintain the Tool and its features, such as the cloud-saving and sharing functionalities.</li>
                        </ul>

                        <h6 class="mt-4">Information Sharing</h6>
                        <p>Your saved effects and your public display name are visible to other users when they browse the Community Gallery. We do not share or sell your personal information with third parties.</p>

                        <h6 class="mt-4">Your Rights</h6>
                        <p>You have the right to delete your saved effects. This can be done from the "My Projects" section of the gallery when you are signed in.</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="import-meta-modal" tabindex="-1" aria-labelledby="importMetaModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="importMetaModalLabel"><i class="bi bi-code-slash me-2"></i>Import from Meta Tags</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>Paste the full block of <strong>&lt;meta&gt;</strong> tags from an old effect file below. This will overwrite your current workspace.</p>
                        </p>
                        <textarea class="form-control font-monospace" id="import-textarea" rows="10" placeholder="<meta title=... />&#10;<meta description=... />&#10;..."></textarea>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" id="confirm-import-btn">Import Effect</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="offcanvas offcanvas-end" tabindex="-1" id="gallery-offcanvas" aria-labelledby="galleryOffcanvasLabel" style="width: 700px;">
            <div class="offcanvas-header">
                <h5 class="offcanvas-title" id="galleryOffcanvasLabel"><i class="bi bi-view-list me-2"></i>Community Gallery</h5>
                <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
            </div>
            <div class="offcanvas-body d-flex flex-column">
                <div class="mb-3 d-flex gap-2">
                    <div class="input-group">
                        <span class="input-group-text"><i class="bi bi-search"></i></span>
                        <input type="text" id="gallery-search-input" class="form-control" placeholder="Search effects...">
                        <button class="btn btn-outline-secondary d-none" type="button" id="gallery-search-clear-btn" title="Clear search">
                            <i class="bi bi-x-lg"></i>
                        </button>
                    </div>
                    <div class="btn-group">
                        <button type="button" class="btn btn-secondary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bi bi-sort-down me-1"></i> Sort By
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item gallery-sort-option" href="#" data-sort="createdAt">Newest</a></li>
                            <li><a class="dropdown-item gallery-sort-option" href="#" data-sort="likes">Most Liked</a></li>
                            <li><a class="dropdown-item gallery-sort-option" href="#" data-sort="downloadCount">Most Downloaded</a></li>
                            <li><a class="dropdown-item gallery-sort-option" href="#" data-sort="name">Alphabetical</a></li>
                        </ul>
                    </div>
                </div>

                <div id="gallery-scroll-container" class="flex-grow-1 overflow-auto pe-2">
                    <div id="gallery-project-list" class="row row-cols-1 row-cols-lg-2 g-3">
                    </div>

                    <div id="gallery-footer" class="text-center py-3" style="display: none;">
                        <div id="gallery-loading-spinner" class="spinner-border text-secondary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="share-modal" tabindex="-1" aria-labelledby="shareModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="shareModalLabel"><i class="bi bi-share-fill me-2"></i>Share Your Effect</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>Anyone with this link can view and load your effect.</p>
                        <div class="input-group">
                            <input type="text" class="form-control" id="share-link-input" readonly>
                            <button class="btn btn-primary" type="button" id="copy-share-link-btn">
                                <i class="bi bi-clipboard"></i> Copy
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="export-options-modal" tabindex="-1" aria-labelledby="exportOptionsModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-lg modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exportOptionsModalLabel"><i class="bi bi-sliders me-2"></i>Export Properties</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body" id="export-options-body">
                        <p class="text-body-secondary">Select which properties will be editable by users in SignalRGB. Unchecked properties will be hardcoded into the effect.</p>
                        <div class="accordion" id="export-options-accordion">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" id="export-copy-code-btn"><i class="bi bi-clipboard me-2"></i>Copy Code</button>
                        <button type="button" class="btn btn-primary" id="confirm-export-zip-btn"><i class="bi bi-file-earmark-zip-fill me-2"></i>Generate .zip File</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="accept-terms-modal" tabindex="-1" aria-labelledby="acceptTermsModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="acceptTermsModalLabel"><i class="bi bi-shield-check me-2"></i>Terms & Privacy</h5>
                    </div>
                    <div class="modal-body">
                        <p>By using this tool, you agree to the <a href="#" data-bs-toggle="modal" data-bs-target="#terms-modal" data-bs-dismiss="modal">Terms of Usage</a> and acknowledge our <a href="#" data-bs-toggle="modal" data-bs-target="#privacy-policy-modal" data-bs-dismiss="modal">Privacy Policy</a>.</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" id="accept-terms-btn" data-bs-dismiss="modal">I Accept</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="copy-props-modal" tabindex="-1" aria-labelledby="copyPropsModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="copyPropsModalLabel"><i class="bi bi-clipboard-plus me-2"></i>Copy Properties</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <form id="copy-props-form">
                        <div class="modal-body">
                            <p>Select the property groups you want to copy from the source object.</p>
                            <div class="list-group">
                                <label class="list-group-item">
                                    <input class="form-check-input me-1" type="checkbox" name="copy-position" checked>
                                    Position (X, Y)
                                </label>
                                <label class="list-group-item">
                                    <input class="form-check-input me-1" type="checkbox" name="copy-size" checked>
                                    Size (Width, Height)
                                </label>
                                <label class="list-group-item">
                                    <input class="form-check-input me-1" type="checkbox" name="copy-rotation" checked>
                                    Rotation & Rotation Speed
                                </label>
                                <label class="list-group-item">
                                    <input class="form-check-input me-1" type="checkbox" name="copy-fill-style" checked>
                                    Fill Style (Type, Colors, Gradient)
                                </label>
                                <label class="list-group-item">
                                    <input class="form-check-input me-1" type="checkbox" name="copy-animation" checked>
                                    Fill Animation (Mode, Speed, Direction)
                                </label>
                                <label class="list-group-item">
                                    <input class="form-check-input me-1" type="checkbox" name="copy-color-animation" checked>
                                    Color Animation (Cycle Colors & Speed)
                                </label>
                                <label class="list-group-item">
                                    <input class="form-check-input me-1" type="checkbox" name="copy-shape-type">
                                    Shape Type
                                </label>
                                <label class="list-group-item d-none" id="shape-specific-props-container">
                                    <input class="form-check-input me-1" type="checkbox" name="copy-shape-specific">
                                    Shape-Specific Properties (<span id="shape-specific-name"></span>)
                                </label>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-primary" id="confirm-copy-props-btn">Copy to Clipboard</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="modal fade" id="pixelArtEditorModal" tabindex="-1" aria-labelledby="pixelArtEditorModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="pixelArtEditorModalLabel">Pixel Art Editor</h5>
                        <div class="ms-auto d-flex align-items-center gap-2">
                            <button type="button" class="btn btn-sm btn-secondary" id="pixel-editor-prev-frame-btn" title="Save and Go to Previous Frame"><i class="bi bi-arrow-left-circle"></i></button>
                            <span id="pixel-editor-frame-counter" class="text-body-secondary small font-monospace"></span>
                            <button type="button" class="btn btn-sm btn-secondary" id="pixel-editor-next-frame-btn" title="Save and Go to Next Frame"><i class="bi bi-arrow-right-circle"></i></button>
                            <div class="vr mx-1"></div>
                            <button type="button" class="btn btn-sm btn-primary" id="pixel-editor-duplicate-frame-btn" title="Duplicate Current Frame"><i class="bi bi-copy"></i> Duplicate</button>
                            <button type="button" class="btn btn-sm btn-danger" id="pixel-editor-delete-frame-btn" title="Delete Current Frame"><i class="bi bi-trash"></i> Delete</button>
                        </div>
                        <button type="button" class="btn-close ms-2" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>

                    <div class="modal-body">
                        <div class="row align-items-end mb-3">
                            <div class="col-md-4">
                                <label for="pixel-editor-width" class="form-label-sm">Grid Width</label>
                                <input type="number" class="form-control" id="pixel-editor-width" value="16" min="1" max="64">
                            </div>
                            <div class="col-md-4">
                                <label for="pixel-editor-height" class="form-label-sm">Grid Height</label>
                                <input type="number" class="form-control" id="pixel-editor-height" value="16" min="1" max="64">
                            </div>
                            <div class="col-md-4">
                                <button type="button" class="btn btn-secondary w-100" id="pixel-editor-resize-btn">Apply New Size</button>
                            </div>
                        </div>
                        <hr>
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <div class="d-flex align-items-center">
                                <strong class="me-3">Tools:</strong>
                                <div class="btn-group" role="group" id="pixel-editor-tools">
                                    <button type="button" class="btn btn-sm btn-secondary active" id="pixel-editor-paint-btn" title="Paint Tool"><i class="bi bi-pencil-fill"></i> Paint</button>
                                    <button type="button" class="btn btn-sm btn-secondary" id="pixel-editor-fill-btn" title="Fill Area"><i class="bi bi-paint-bucket"></i> Fill</button>
                                    <button type="button" class="btn btn-sm btn-secondary" id="pixel-editor-mirror-h-btn" title="Flip Horizontal"><i class="bi bi-arrow-left-right"></i></button>
                                    <button type="button" class="btn btn-sm btn-secondary" id="pixel-editor-mirror-v-btn" title="Flip Vertical"><i class="bi bi-arrow-down-up"></i></button>
                                </div>
                            </div>
                            <div class="d-flex align-items-center">
                                <strong class="me-3">Paint:</strong>
                                <div class="btn-group" role="group" id="pixel-editor-palette">
                                    <button type="button" class="btn btn-sm btn-light active" data-value="0.7" style="background: repeating-conic-gradient(#4169E1 0% 25%, #6495ED 0% 50%) 50% / 10px 10px;" title="Use object's main fill style (value: 0.7)">Selected Fill</button>
                                </div>
                            </div>
                        </div>
                        <div class="form-text text-center mt-2">
                            Use <kbd>Ctrl</kbd>+<kbd>Arrows</kbd> to shift the current frame, or <kbd>Shift</kbd>+<kbd>Arrows</kbd> to shift all frames.
                            <br>You can also press <kbd>Ctrl</kbd>+<kbd>V</kbd> to paste an image.
                        </div>
                        <div id="pixel-editor-grid-container" class="bg-dark p-1" style="cursor: pointer; user-select: none;">
                        </div>
                        <hr>
                        <p>
                            <a class="btn btn-sm btn-secondary" data-bs-toggle="collapse" href="#collapseRawData" role="button" aria-expanded="false" aria-controls="collapseRawData">
                                <i class="bi bi-code-slash"></i> View Raw Data
                            </a>
                        </p>
                        <div class="collapse" id="collapseRawData">
                            <div class="card card-body bg-dark">
                                <label for="pixel-editor-raw-data" class="form-label-sm">JSON Data (Advanced)</label>
                                <textarea id="pixel-editor-raw-data" class="form-control font-monospace" rows="5"></textarea>
                                <div class="form-text">Changes here will override the visual editor if the JSON is valid.</div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" id="pixel-editor-save-btn">Apply Changes</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="paste-sprite-modal" tabindex="-1" aria-labelledby="pasteSpriteModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="pasteSpriteModalLabel"><i class="bi bi-clipboard-image me-2"></i>Paste Sprite Sheet</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>Enter the dimensions of a **single frame**. The code will automatically detect the number of rows and columns in the sprite sheet you paste.</p>
                        <p class="form-text">Looking for sprites? <a href="https://itch.io/game-assets/free/tag-16x16" target="_blank" rel="noopener">Find free sprite assets on itch.io <i class="bi bi-box-arrow-up-right"></i></a></p>
                        <div class="row">
                            <div class="col">
                                <label for="sprite-frame-width" class="form-label-sm">Single Frame Width</label>
                                <input type="number" class="form-control" id="sprite-frame-width" value="16" min="1" max="128">
                            </div>
                            <div class="col">
                                <label for="sprite-frame-height" class="form-label-sm">Single Frame Height</label>
                                <input type="number" class="form-control" id="sprite-frame-height" value="16" min="1" max="128">
                            </div>
                        </div>
                        <div class="form-check form-switch my-3">
                            <input class="form-check-input" type="checkbox" id="sprite-downsample">
                            <label class="form-check-label" for="sprite-downsample">Downsample to frame dimensions (for hi-res pixel art)</label>
                        </div>
                        <div class="form-check form-switch my-3">
                            <input class="form-check-input" type="checkbox" id="sprite-paste-append">
                            <label class="form-check-label" for="sprite-paste-append">Append to existing frames (instead of replacing)</label>
                        </div>
                        <hr>
                        <div class="d-grid">
                            <button type="button" class="btn btn-primary" id="confirm-sprite-paste-btn"><i class="bi bi-clipboard-check-fill me-2"></i>Paste from Clipboard</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="pixel-art-gallery-modal" tabindex="-1" aria-labelledby="pixelArtGalleryModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="pixelArtGalleryModalLabel"><i class="bi bi-substack me-2"></i>Community Pixel Art</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="row mb-3">
                            <div class="col-12">
                                <div class="input-group">
                                    <span class="input-group-text"><i class="bi bi-search"></i></span>
                                    <input type="text" id="pixel-art-search-input" class="form-control" placeholder="Search by effect name or creator...">
                                </div>
                            </div>
                        </div>
                        <div id="modal-pixel-art-container" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
                        </div>
                    </div>
                    <div class="modal-footer d-flex justify-content-center">
                        <nav aria-label="Pixel Art Gallery Pagination">
                            <ul class="pagination mb-0" id="pixel-art-pagination-container">
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="upload-gif-modal" tabindex="-1" aria-labelledby="uploadGifModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="uploadGifModalLabel"><i class="bi bi-film me-2"></i>Upload GIF Options</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>Specify the target pixel art dimensions for your animation.</p>
                        <div class="row">
                            <div class="col">
                                <label for="gif-target-width" class="form-label-sm">Target Width</label>
                                <input type="number" class="form-control" id="gif-target-width" value="16" min="1" max="128">
                            </div>
                            <div class="col">
                                <label for="gif-target-height" class="form-label-sm">Target Height</label>
                                <input type="number" class="form-control" id="gif-target-height" value="16" min="1" max="128">
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col">
                                <label for="gif-max-colors" class="form-label-sm">Max Colors (2-32)</label>
                                <input type="number" class="form-control" id="gif-max-colors" value="16" min="2" max="32">
                                <div class="form-text">Reduces the GIF's palette to the specified number of colors.</div>
                            </div>
                        </div>
                        <div class="form-check form-switch my-3">
                            <input class="form-check-input" type="checkbox" id="gif-append-frames">
                            <label class="form-check-label" for="gif-append-frames">Append to existing frames (instead of replacing)</label>
                        </div>
                        <hr>
                        <div id="gif-info-display" class="text-body-secondary small" style="display: none;">
                            <p class="mb-1"><strong>Original GIF Info:</strong></p>
                            <ul class="list-unstyled mb-0">
                                <li>Dimensions: <span id="gif-info-dims">--</span></li>
                                <li>Unique Colors: <span id="gif-info-colors">--</span></li>
                            </ul>
                        </div>
                        <hr>
                        <div class="d-grid">
                            <button type="button" class="btn btn-primary" id="confirm-gif-upload-btn">...</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="color-mapper-modal" tabindex="-1" aria-labelledby="colorMapperModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="colorMapperModalLabel"><i class="bi bi-palette-fill me-2"></i>Map Colors</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>Assign the most common colors from the first frame to the available slots in your object's palette.</p>
                        <div class="row">
                            <div class="col-md-5">
                                <h6 class="text-center">First Frame Preview</h6>
                                <canvas id="color-mapper-preview" class="w-100 border rounded" style="image-rendering: pixelated;"></canvas>
                            </div>
                            <div class="col-md-7">
                                <h6 class="text-center">Color Assignments</h6>
                                <div id="color-mapper-assignments" class="d-grid gap-2">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" id="confirm-color-map-btn">Process Image</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="pixel-art-color-picker-modal" tabindex="-1" aria-labelledby="pixelArtColorPickerModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" style="width: 280px;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="pixelArtColorPickerModalLabel">Edit Color</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body d-flex flex-column justify-content-center">
                        <div id="modal-picker-container"></div>
                        <div class="custom-color-inputs mt-3">
                            <div class="input-group input-group-sm mb-2">
                                <span class="input-group-text">HEX</span>
                                <input type="text" class="form-control" id="pixel-editor-hex-input">
                            </div>
                            <div class="input-group input-group-sm">
                                <span class="input-group-text">RGB</span>
                                <input type="number" class="form-control" id="pixel-editor-r-input" min="0" max="255" aria-label="Red">
                                <input type="number" class="form-control" id="pixel-editor-g-input" min="0" max="255" aria-label="Green">
                                <input type="number" class="form-control" id="pixel-editor-b-input" min="0" max="255" aria-label="Blue">
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Done</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="general-color-picker-modal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" style="width: 280px;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Select Color</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body d-flex justify-content-center">
                        <div id="general-picker-container"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="gif-search-modal" tabindex="-1" aria-labelledby="gifSearchModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="gifSearchModalLabel"><i class="bi bi-film me-2"></i>Search for GIFs</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="gif-search-form" class="mb-3">
                            <div class="input-group">
                                <input type="text" id="gif-search-input" class="form-control" placeholder="Search for GIFs..." required>
                                <button class="btn btn-primary" type="submit"><i class="bi bi-search"></i> Search</button>
                            </div>
                        </form>
                        <div id="gif-results-container" class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-3">
                        </div>
                    </div>
                    <div class="modal-footer d-flex justify-content-between align-items-center">
                        <div>Powered by: <img src="xQVVOLyi.png" alt="Powered by Giphy" height="30"></div>
                        <div id="gif-search-footer" style="display: none;"></div>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
        <script type="module">
            import { parseGIF, decompressFrames } from 'https://cdn.jsdelivr.net/npm/gifuct-js@2.1.2/+esm';
            window.parseGIF = parseGIF;
            window.decompressFrames = decompressFrames;
        </script>
        <script src="Shape.js"></script>
        <script src="util.js"></script>
        <script src="main.js"></script>
</body>

</html>