<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SRGB Component Builder</title>
    <meta property="og:title" content="SRGB Component Builder">
    <meta property="og:description" content="A tool for creating custom LED component layouts for SignalRGB.">
    <meta property="og:type" content="website">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <script type="module" src="firebase.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>

<body class="d-flex flex-column vh-100">
    <nav class="navbar navbar-expand-lg bg-body-tertiary">
        <div class="container-fluid">
            <a class="navbar-brand d-flex align-items-center" href="./">
                <img src="../logo.png" alt="Effect Builder Logo" class="me-2" style="height: 1.5em;"> SRGB Component Builder
            </a>

            <div class="ms-auto d-flex align-items-center">

                <div class="btn-group me-3" role="group" aria-label="Project management actions">
                    <button class="btn btn-primary" id="new-component-btn" data-bs-toggle="tooltip" title="New Component"><i class="bi bi-file-earmark-plus me-1"></i> New</button>
                    <button class="btn btn-primary" id="save-component-btn" data-bs-toggle="tooltip" title="Save current component to the cloud" disabled><i class="bi bi-cloud-arrow-up me-1"></i> Save</button>
                    <button class="btn btn-secondary" id="share-component-btn" data-bs-toggle="tooltip" title="Get a shareable link to this component" disabled><i class="bi bi-share me-1"></i> Share</button>
                    <button class="btn btn-secondary" id="import-json-btn" data-bs-toggle="tooltip" title="Import Component from JSON file"> <i class="bi bi-upload me-1"></i> Import JSON</button>
                    <button class="btn btn-secondary" id="export-component-btn" data-bs-toggle="modal" data-bs-target="#export-component-modal" title="Download Component JSON file"> <i class="bi bi-download me-1"></i> Export JSON</button>
                </div>

                <div class="btn-group me-3" role="group" aria-label="Community">
                    <button class="btn btn-primary" id="browse-gallery-btn" data-bs-toggle="offcanvas" data-bs-target="#gallery-offcanvas" aria-controls="gallery-offcanvas" title="Browse the Community Component Gallery"><i class="bi bi-view-list me-1"></i> Community Gallery</button>
                </div>
                <div class="btn-group me-3" role="group" aria-label="Community">
                    <a href="../" class="btn btn-primary" title="Return to SRGB Effect Builder"><i class="bi bi-view-list me-1"></i> Return to Editor</a>
                </div>

                <div class="btn-group me-3" role="group" aria-label="Help and settings">
                    <button class="btn btn-secondary" id="help-btn" data-bs-toggle="modal" data-bs-target="#help-modal" title="Help"><i class="bi bi-question-circle"></i></button>
                    <button class="btn btn-secondary" id="about-btn" data-bs-toggle="modal" data-bs-target="#about-modal" title="About"><i class="bi bi-info-circle"></i></button>
                    <a class="btn btn-secondary" id="contact-btn" href="#" target="_blank" rel="noopener" title="Report Bug / Request Feature on GitHub">
                        <i class="bi bi-github"></i>
                    </a>
                    <button class="btn btn-secondary" type="button" id="theme-switcher-btn" title="Change Theme">
                        <i class="bi" id="theme-icon"></i>
                    </button>
                </div>

                <div id="auth-notification-block" class="d-flex align-items-center">
                    <button class="btn btn-success" id="login-btn"><i class="bi bi-google me-2"></i>Sign In</button>
                    <div class="btn-group d-none" id="user-session-group" role="group" aria-label="User actions">
                        <span class="btn btn-secondary d-flex align-items-center disabled" style="pointer-events: none;">
                            <img id="user-photo" class="rounded-circle me-2" style="width: 24px; height: 24px;" alt="User profile photo">
                            <span id="user-display"></span>
                        </span>
                        <button class="btn btn-danger" id="logout-btn" title="Sign Out"><i class="bi bi-box-arrow-right"></i></button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="container-fluid flex-grow-1 overflow-hidden p-0">
        <div class="h-100" id="main-split">

            <div id="left-panel" class="h-100 p-3 border-end bg-body-tertiary" style="overflow: auto;">
                <div class="h-100 d-flex flex-column">
                    <div id="component-properties" class="mb-3">
                        <h4 class="text-body-emphasis">Component Properties</h4>
                        <div class="row mb-2">
                            <div class="col">
                                <label for="component-name" class="form-label form-label-sm">Product Name</label>
                                <input type="text" id="component-name" class="form-control form-control-sm" placeholder="e.g., My Custom Fan">
                            </div>
                        </div>
                        <div class="row mb-2">
                            <div class="col">
                                <label for="component-display-name" class="form-label form-label-sm">Display Name</label>
                                <input type="text" id="component-display-name" class="form-control form-control-sm" placeholder="e.g., My Custom Fan">
                            </div>
                        </div>
                        <div class="row mb-2">
                            <div class="col">
                                <label for="component-brand" class="form-label form-label-sm">Brand</label>
                                <input type="text" id="component-brand" class="form-control form-control-sm" placeholder="e.g., Custom">
                            </div>
                            <div class="col">
                                <label for="component-type" class="form-label form-label-sm">Component Type</label>
                                <select id="component-type" class="form-select form-select-sm">
                                    <option>AIO Liquid Cooler</option>
                                    <option>Air Cooler</option>
                                    <option>Case</option>
                                    <option>Desk</option>
                                    <option>Fan</option>
                                    <option>GPU</option>
                                    <option>Headset</option>
                                    <option>Headset Stand</option>
                                    <option>Keyboard</option>
                                    <option>Matrix</option>
                                    <option>Motherboard</option>
                                    <option>Monitor</option>
                                    <option>Mouse</option>
                                    <option>Mousepad</option>
                                    <option>PSU</option>
                                    <option>RAM</option>
                                    <option>Speaker</option>
                                    <option>Storage</option>
                                    <option>Strimer</option>
                                    <option>Strip</option>
                                    <option>Other</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-2">
                            <label for="component-image" class="form-label form-label-sm">Device Image (Optional)</label>
                            <input type="file" id="component-image" class="form-control form-control-sm" accept="image/png, image/webp">
                            <div class="form-text mb-1">Max 800x400 recommended.</div>

                            <div id="image-paste-zone" class="p-3 text-center text-muted border border-dashed rounded-3" style="cursor: copy; min-height: 100px; display: flex; align-items: center; justify-content: center; background-color: var(--bs-body-bg);" contenteditable="true" title="Click here and press Ctrl+V to paste an image">

                                <img id="image-preview" src="#" alt="Image Preview" class="img-fluid rounded" style="max-width: 100%; display: none;">

                                <span id="image-paste-placeholder" style="pointer-events: none;">
                                    <i class="bi bi-clipboard-plus fs-3"></i>
                                    <br>
                                    Click to paste image
                                </span>
                            </div>
                        </div>
                        <hr>
                    </div>

                    <div id="elements-and-wiring" class="flex-grow-1 overflow-auto pe-2">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h4 class="text-body-emphasis mb-0">Shapes</h4>
                            <span id="led-count-display" class="badge bg-secondary rounded-pill fs-6">0 LEDs</span>
                        </div>
                        <div id="led-warning-display" class="form-text text-warning d-none" style="margin-top: -0.5rem; margin-bottom: 0.5rem;">
                            <i class="bi bi-exclamation-triangle-fill me-1"></i>
                            Most motherboard ARGB headers support ~120 LEDs. You are adding more at your own risk!
                        </div>
                        <div class="mb-3">
                            <div class="shape-gallery">

                                <button class="btn btn-outline-secondary shape-gallery-item" id="add-matrix-btn" data-bs-toggle="tooltip" title="Add Matrix (Rectangle)">
                                    <svg viewBox="0 0 32 32" fill="currentColor" width="32" height="32" class="d-block mb-1">
                                        <circle cx="8" cy="8" r="3" />
                                        <circle cx="16" cy="8" r="3" />
                                        <circle cx="24" cy="8" r="3" />
                                        <circle cx="8" cy="16" r="3" />
                                        <circle cx="16" cy="16" r="3" />
                                        <circle cx="24" cy="16" r="3" />
                                        <circle cx="8" cy="24" r="3" />
                                        <circle cx="16" cy="24" r="3" />
                                        <circle cx="24" cy="24" r="3" />
                                    </svg>
                                    <small>Matrix</small>
                                </button>

                                <button class="btn btn-outline-secondary shape-gallery-item" id="add-strip-btn" data-bs-toggle="tooltip" title="Add Strip (Coming Soon)">
                                    <svg viewBox="0 0 32 32" fill="currentColor" width="32" height="32" class="d-block mb-1">
                                        <circle cx="8" cy="16" r="3" />
                                        <circle cx="16" cy="16" r="3" />
                                        <circle cx="24" cy="16" r="3" />
                                    </svg>
                                    <small>Strip</small>
                                </button>

                                <button class="btn btn-outline-secondary shape-gallery-item" id="add-circle-btn" data-bs-toggle="tooltip" title="Add Circle (Coming Soon)">
                                    <svg viewBox="0 0 32 32" fill="currentColor" width="32" height="32" class="d-block mb-1">
                                        <circle cx="26" cy="16" r="3" />
                                        <circle cx="23" cy="23" r="3" />
                                        <circle cx="16" cy="26" r="3" />
                                        <circle cx="9" cy="23" r="3" />
                                        <circle cx="6" cy="16" r="3" />
                                        <circle cx="9" cy="9" r="3" />
                                        <circle cx="16" cy="6" r="3" />
                                        <circle cx="23" cy="9" r="3" />
                                    </svg>
                                    <small>Circle</small>
                                </button>

                                <button class="btn btn-outline-secondary shape-gallery-item" id="add-l-shape-btn" data-bs-toggle="tooltip" title="L-Shape (Coming Soon)">
                                    <svg viewBox="0 0 32 32" fill="currentColor" width="32" height="32" class="d-block mb-1">
                                        <circle cx="8" cy="8" r="3" />
                                        <circle cx="8" cy="16" r="3" />
                                        <circle cx="8" cy="24" r="3" />
                                        <circle cx="16" cy="24" r="3" />
                                    </svg>
                                    <small>L-Shape</small>
                                </button>

                                <button class="btn btn-outline-secondary shape-gallery-item" id="add-u-shape-btn" data-bs-toggle="tooltip" title="U-Shape (Coming Soon)">
                                    <svg viewBox="0 0 32 32" fill="currentColor" width="32" height="32" class="d-block mb-1">
                                        <circle cx="8" cy="8" r="3" />
                                        <circle cx="24" cy="8" r="3" />
                                        <circle cx="8" cy="16" r="3" />
                                        <circle cx="24" cy="16" r="3" />
                                        <circle cx="8" cy="24" r="3" />
                                        <circle cx="16" cy="24" r="3" />
                                        <circle cx="24" cy="24" r="3" />
                                    </svg>
                                    <small>U-Shape</small>
                                </button>

                            </div>
                        </div>

                        <svg class="d-none" id="svg-placeholder-shape">
                            <symbol viewBox="0 0 32 32" id="shape-placeholder">
                                <path fill="none" stroke="currentColor" stroke-width="2" stroke-dasharray="4 2" d="M6 6h20v20H6z" />
                            </symbol>
                        </svg>
                    </div>

                </div>
            </div>

            <div id="right-panel" class="d-flex flex-column h-100">
                <div id="toolbar" class="bg-body-tertiary p-2 rounded d-flex flex-wrap">

                    <div class="btn-group me-2 mb-1" role="group">
                        <button class="btn btn-secondary" id="tool-select-btn" data-bs-toggle="tooltip" title="Select Tool (V)"><i class="bi bi-cursor-fill"></i></button>
                        <button class="btn btn-secondary" id="tool-place-led-btn" data-bs-toggle="tooltip" title="Place LED Tool (P)"><i class="bi bi-circle-fill"></i></button>
                        <button class="btn btn-secondary" id="tool-wiring-btn" data-bs-toggle="tooltip" title="Wiring Tool (W)"><i class="bi bi-vector-pen"></i></button>
                    </div>

                    <div class="btn-group me-2 mb-1" role="group">
                        <button class="btn btn-secondary" id="zoom-in-btn" data-bs-toggle="tooltip" title="Zoom In (+)"><i class="bi bi-zoom-in"></i></button>
                        <button class="btn btn-secondary" id="zoom-out-btn" data-bs-toggle="tooltip" title="Zoom Out (-)"><i class="bi bi-zoom-out"></i></button>
                        <button class="btn btn-secondary" id="zoom-reset-btn" data-bs-toggle="tooltip" title="Reset Zoom (0)"><i class="bi bi-aspect-ratio"></i></button>
                    </div>
                    <div class="btn-group me-2 mb-1" role="group">
                        <button class="btn btn-secondary" id="rotate-selected-btn" title="Rotate Selected LEDs (+90° Counter-Clockwise)"><i class="bi bi-arrow-counterclockwise"></i></button>
                        <button class="btn btn-secondary" id="scale-selected-btn" data-bs-toggle="modal" data-bs-target="#scale-selected-modal" title="Scale Selected LEDs (S)"><i class="bi bi-arrows-angle-expand"></i></button>
                    </div>

                    <div class="btn-group me-2 mb-1" role="group">
                        <button class="btn btn-secondary" id="toggle-grid-btn" data-bs-toggle="tooltip" title="Toggle Grid (G)"><i class="bi bi-grid-3x3"></i></button>
                    </div>
                </div>

                <div id="right-panel-top" class="d-flex flex-column" style="overflow: hidden; background-color: #2b3035;">
                    <div id="component-canvas-container" class="m-auto position-relative bg-body-tertiary" style="width: 500px; height: 300px; border: 1px dashed grey; overflow: auto; background-color: #343a40;">
                        <canvas id="componentCanvas" width="1000" height="600"></canvas>
                    </div>
                </div>

                <div class="ms-auto ps-3 text-body-secondary d-flex align-items-center">
                    <i class="bi bi-crosshair me-2"></i>
                    <span id="coords-display" class="font-monospace" style="min-width: 100px;">---, ---</span>
                </div>
            </div>
        </div>

        <div class="toast-container position-fixed bottom-0 end-0 p-3" style="z-index: 99999">
            <div id="app-toast" class="toast border-0" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="5000" style="width: 350px; font-size: 1.1rem;">
                <div id="app-toast-header" class="toast-header d-flex align-items-center">
                    <i id="app-toast-icon" class="bi me-2"></i>
                    <strong class="me-auto" id="app-toast-title">Notification</strong>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
                <div class="toast-body" id="app-toast-body">
                </div>
            </div>
        </div>

        <div class="modal fade" id="load-project-modal" tabindex="-1">...</div>
        <div class="modal fade" id="save-project-modal" tabindex="-1">...</div>
        <div class="modal fade" id="notification-modal" tabindex="-1">...</div>
        <div class="modal fade" id="confirm-overwrite-modal" tabindex="-1">...</div>

        <div class="modal fade" id="help-modal" tabindex="-1" aria-labelledby="helpModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="helpModalLabel"><i class="bi bi-question-circle me-2"></i>Help & Quick Guide</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>Welcome to the SRGB Component Builder. Here are the basics to get you started.</p>

                        <div class="accordion" id="help-accordion">

                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#help-canvas-controls" aria-expanded="true">
                                        <i class="bi bi-arrows-move me-2"></i><strong>Canvas Controls</strong>
                                    </button>
                                </h2>
                                <div id="help-canvas-controls" class="accordion-collapse collapse show" data-bs-parent="#help-accordion">
                                    <div class="accordion-body">
                                        <ul class="list-group">
                                            <li class="list-group-item"><strong>Pan Canvas:</strong> Hold the <strong>Middle Mouse Button</strong> and drag.</li>
                                            <li class="list-group-item"><strong>Zoom Canvas:</strong> Use the <strong>Mouse Wheel</strong> to zoom in and out.</li>
                                            <li class="list-group-item"><strong>Reset View:</strong> Click the <i class="bi bi-aspect-ratio"></i> (Reset Zoom) button or press `0`.</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#help-toolbar" aria-expanded="false">
                                        <i class="bi bi-tools me-2"></i><strong>Toolbar Explained</strong>
                                    </button>
                                </h2>
                                <div id="help-toolbar" class="accordion-collapse collapse" data-bs-parent="#help-accordion">
                                    <div class="accordion-body">
                                        <ul class="list-group">
                                            <li class="list-group-item">
                                                <strong><i class="bi bi-cursor-fill me-2"></i>Select Tool (V):</strong>
                                                Used to select LEDs.
                                                <ul>
                                                    <li>Click an LED to select it.</li>
                                                    <li>Hold **Shift** while clicking to add/remove LEDs from your selection.</li>
                                                    <li>Click and drag on an empty area to create a selection box.</li>
                                                    <li>Click and drag a selected LED to move the entire selection.</li>
                                                </ul>
                                            </li>
                                            <li class="list-group-item">
                                                <strong><i class="bi bi-circle-fill me-2"></i>Place LED Tool (P):</strong>
                                                Click on the grid to place an LED. Each subsequent click will place a new LED and automatically wire it to the previous one in a chain.
                                                <ul>
                                                    <li><strong>Right-click</strong> to stop the current chain.</li>
                                                </ul>
                                            </li>
                                            <li class="list-group-item">
                                                <strong><i class="bi bi-vector-pen me-2"></i>Wiring Tool (W):</strong>
                                                Used to manually connect LEDs.
                                                <ul>
                                                    <li>Click an unwired LED or the end-point of a chain to start a wire.</li>
                                                    <li>Click another valid LED (unwired or an end-point) to complete the connection.</li>
                                                    <li><strong>Right-click an LED</strong> to remove it from its wire chain.</li>
                                                    <li><strong>Right-click a wire segment</strong> to break the circuit in two at that point.</li>
                                                </ul>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#help-shortcuts" aria-expanded="false">
                                        <i class="bi bi-keyboard me-2"></i><strong>Keyboard Shortcuts</strong>
                                    </button>
                                </h2>
                                <div id="help-shortcuts" class="accordion-collapse collapse" data-bs-parent="#help-accordion">
                                    <div class="accordion-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <ul class="list-group">
                                                    <li class="list-group-item">`V` - Activate Select Tool</li>
                                                    <li class="list-group-item">`P` - Activate Place LED Tool</li>
                                                    <li class="list-group-item">`W` - Activate Wiring Tool</li>
                                                    <li class="list-group-item">`G` - Toggle Grid</li>
                                                    <li class="list-group-item">`S` - Scale Selected LEDs</li>
                                                </ul>
                                            </div>
                                            <div class="col-md-6">
                                                <ul class="list-group">
                                                    <li class="list-group-item">`Delete` / `Backspace` - Delete Selected</li>
                                                    <li class="list-group-item">`+` (Numpad) - Zoom In</li>
                                                    <li class="list-group-item">`-` (Numpad) - Zoom Out</li>
                                                    <li class="list-group-item">`0` (Numpad) - Reset Zoom</li>
                                                </ul>
                                            </div>
                                        </div>
                                        <h6 class="mt-3">Actions</h6>
                                        <ul class="list-group">
                                            <li class="list-group-item"><strong>Click <i class="bi bi-arrow-counterclockwise"></i> Button:</strong> Rotate selected 90° counter-clockwise.</li>
                                            <li class="list-group-item"><strong>Shift + Click <i class="bi bi-arrow-counterclockwise"></i> Button:</strong> Rotate selected 90° clockwise.</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#help-saving" aria-expanded="false">
                                        <i class="bi bi-cloud-arrow-up me-2"></i><strong>Saving & Loading</strong>
                                    </button>
                                </h2>
                                <div id="help-saving" class="accordion-collapse collapse" data-bs-parent="#help-accordion">
                                    <div class="accordion-body">
                                        <div class="alert alert-info"><i class="bi bi-exclamation-circle-fill me-2"></i>You must be <strong>signed in</strong> to save components to the cloud.</div>
                                        <ul class="list-group">
                                            <li class="list-group-item"><strong>New:</strong> Clears the canvas. It will ask for confirmation if you have unsaved changes.</li>
                                            <li class="list-group-item"><strong>Save:</strong> Saves your current component to the cloud under your account. If you loaded a community component, this will "fork" it and save a new copy for you.</li>
                                            <li class="list-group-item"><strong>Import JSON:</strong> Lets you load a component from a `.json` file from your computer.</li>
                                            <li class="list-group-item"><strong>Export JSON:</strong> Generates a `.json` file for use in SignalRGB. <strong>All LEDs must be wired</strong> for the export to be valid.</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Got it!</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="about-modal" tabindex="-1" aria-labelledby="aboutModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="aboutModalLabel">About SRGB Component Builder</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p><strong>SRGB Component Builder</strong> is a web-based visual tool designed to simplify the creation of custom component <code>.json</code> files for the <a href="https://signalrgb.com/" target="_blank">SignalRGB</a> platform.</p>
                        <p>Built by José A. Miranda Vélez in the beautiful island of Puerto Rico, this project aims to provide an intuitive, grid-based interface for designers and enthusiasts to map out LEDs for their custom devices.</p>
                        <ul class="list-group">
                            <li class="list-group-item">
                                <strong>Version:</strong> <span id="version-display">1.0</span>
                            </li>
                            <li class="list-group-item">
                                <strong>Project Home:</strong> <a href="https://github.com/joseamirandavelez" target="_blank">View on GitHub</a>
                            </li>
                            <li class="list-group-item">
                                <strong>Terms & Privacy:</strong>
                                <a href="#" data-bs-toggle="modal" data-bs-target="#terms-modal" data-bs-dismiss="modal">Terms of Usage</a> |
                                <a href="#" data-bs-toggle="modal" data-bs-target="#privacy-policy-modal" data-bs-dismiss="modal">Privacy Policy</a>
                            </li>
                        </ul>
                        <h6 class="mt-4">Credits & Technology</h6>
                        <p>This tool is built using <a href="https://firebase.google.com/" target="_blank">Firebase</a> for cloud storage and authentication, and <a href="https://getbootstrap.com/" target="_blank">Bootstrap</a> for the user interface.</p>
                    </div>
                    <div class="modal-footer">
                        <div class="text-muted small me-auto">© 2025 José A. Miranda Vélez. All Rights Reserved.</div>
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="terms-modal" tabindex="-1">...</div>
        <div class="modal fade" id="privacy-policy-modal" tabindex="-1">...</div>
        <div class="modal fade" id="accept-terms-modal" tabindex="-1">...</div>

        <div class="offcanvas offcanvas-end" tabindex="-1" id="gallery-offcanvas" aria-labelledby="galleryOffcanvasLabel" style="width: 500px;">
            <div class="offcanvas-header">
                <h5 class="offcanvas-title" id="galleryOffcanvasLabel"><i class="bi bi-folder2-open me-2"></i>Open Component</h5>
                <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
            </div>
            <div class="offcanvas-body">
                <div id="user-component-list" class="list-group">
                </div>
            </div>
        </div>

        <div class="modal fade" id="share-modal" tabindex="-1">...</div>

        <div class="modal fade" id="export-component-modal" tabindex="-1" aria-labelledby="exportComponentModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exportComponentModalLabel"><i class="bi bi-filetype-json me-2"></i>Export Component</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>Your component JSON will be generated.</p>
                        <pre id="json-preview" style="max-height: 300px; overflow: auto; background-color: var(--bs-tertiary-bg); padding: 10px; border-radius: 5px;"><code>{...}</code></pre>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" id="confirm-export-json-btn"><i class="bi bi-download me-2"></i>Download .json</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="add-matrix-modal" tabindex="-1" aria-labelledby="addMatrixModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addMatrixModalLabel"><i class="bi bi-grid-3x3-gap me-2"></i>Add LED Matrix</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>A grid of LEDs will be created at the center of your view.</p>
                        <div class="row mb-3">
                            <div class="col">
                                <label for="matrix-cols" class="form-label">Columns</label>
                                <input type="number" id="matrix-cols" class="form-control" value="8" min="1">
                            </div>
                            <div class="col">
                                <label for="matrix-rows" class="form-label">Rows</label>
                                <input type="number" id="matrix-rows" class="form-control" value="8" min="1">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col">
                                <label for="matrix-wiring" class="form-label">Wiring Direction</label>
                                <select id="matrix-wiring" class="form-select">
                                    <option value="horizontal" selected>Horizontal Serpentine (Left-to-Right)</option>
                                    <option value="vertical">Vertical Serpentine (Top-to-Bottom)</option>
                                </select>
                                <div class="form-text">Determines the auto-wiring path.</div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" id="confirm-add-matrix-btn">Create Matrix</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="add-strip-modal" tabindex="-1" aria-labelledby="addStripModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addStripModalLabel"><i class="bi bi-grip-horizontal me-2"></i>Add LED Strip</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="row mb-3">
                            <div class="col">
                                <label for="strip-led-count" class="form-label">LED Count</label>
                                <input type="number" id="strip-led-count" class="form-control" value="10" min="1">
                            </div>
                            <div class="col">
                                <label for="strip-orientation" class="form-label">Orientation</label>
                                <select id="strip-orientation" class="form-select">
                                    <option value="horizontal" selected>Horizontal</option>
                                    <option value="vertical">Vertical</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" id="confirm-add-strip-btn">Create Strip</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="add-circle-modal" tabindex="-1" aria-labelledby="addCircleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addCircleModalLabel"><i class="bi bi-circle-dotted me-2"></i>Add LED Circle</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="row mb-3">
                            <div class="col">
                                <label for="circle-led-count" class="form-label">LED Count</label>
                                <input type="number" id="circle-led-count" class="form-control" value="12" min="1">
                            </div>
                            <div class="col">
                                <label for="circle-radius" class="form-label">Radius (grid units)</label>
                                <input type="number" id="circle-radius" class="form-control" value="5" min="1">
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" id="confirm-add-circle-btn">Create Circle</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="add-l-shape-modal" tabindex="-1" aria-labelledby="addLShapeModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addLShapeModalLabel"><i class="bi bi-justify-left me-2"></i>Add L-Shape</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>Creates an L-shape with the corner at the bottom-left. Wiring runs top-to-bottom, then left-to-right.</p>
                        <div class="row mb-3">
                            <div class="col">
                                <label for="l-shape-a-leds" class="form-label">Side A (Vertical)</label>
                                <input type="number" id="l-shape-a-leds" class="form-control" value="5" min="1">
                            </div>
                            <div class="col">
                                <label for="l-shape-b-leds" class="form-label">Side B (Horizontal)</label>
                                <input type="number" id="l-shape-b-leds" class="form-control" value="5" min="1">
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" id="confirm-add-l-shape-btn">Create L-Shape</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="add-u-shape-modal" tabindex="-1" aria-labelledby="addUShapeModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addUShapeModalLabel"><i class="bi bi-reception-3 me-2"></i>Add U-Shape</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>Wiring runs down Side A, across Side B, and up Side C.</p>
                        <div class="row mb-3">
                            <div class="col">
                                <label for="u-shape-a-leds" class="form-label">Side A (Left)</label>
                                <input type="number" id="u-shape-a-leds" class="form-control" value="4" min="1">
                            </div>
                            <div class="col">
                                <label for="u-shape-b-leds" class="form-label">Side B (Bottom)</label>
                                <input type="number" id="u-shape-b-leds" class="form-control" value="4" min="1">
                            </div>
                            <div class="col">
                                <label for="u-shape-c-leds" class="form-label">Side C (Right)</label>
                                <input type="number" id="u-shape-c-leds" class="form-control" value="4" min="1">
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" id="confirm-add-u-shape-btn">Create U-Shape</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="add-lili-modal" tabindex="-1" aria-labelledby="addLiLiModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addLiLiModalLabel">Add LiLi Logo Shape</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>Based on the icon, this creates two vertical strips and one circle as three separate wiring circuits.</p>
                        <div class="row mb-3">
                            <div class="col">
                                <label for="lili-strip-leds" class="form-label">Strip LEDs</label>
                                <input type="number" id="lili-strip-leds" class="form-control" value="3" min="1">
                            </div>
                            <div class="col">
                                <label for="lili-circle-leds" class="form-label">Circle LEDs</label>
                                <input type="number" id="lili-circle-leds" class="form-control" value="8" min="1">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col">
                                <label for="lili-circle-radius" class="form-label">Circle Radius</label>
                                <input type="number" id="lili-circle-radius" class="form-control" value="4" min="1">
                            </div>
                            <div class="col">
                                <label for="lili-spacing" class="form-label">Spacing</label>
                                <input type="number" id="lili-spacing" class="form-control" value="2" min="1">
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" id="confirm-add-lili-btn">Create Shape</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="add-hexagon-modal" tabindex="-1" aria-labelledby="addHexagonModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addHexagonModalLabel"><i class="bi bi-hexagon me-2"></i>Add Hexagon</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="row mb-3">
                            <div class="col">
                                <label for="hexagon-leds-per-side" class="form-label">LEDs per Side</label>
                                <input type="number" id="hexagon-leds-per-side" class="form-control" value="4" min="2">
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" id="confirm-add-hexagon-btn">Create Hexagon</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="add-triangle-empty-modal" tabindex="-1" aria-labelledby="addTriangleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addTriangleModalLabel"><i class="bi bi-triangle me-2"></i>Add Triangle</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="row mb-3">
                            <div class="col">
                                <label for="triangle-leds-per-side" class="form-label">LEDs per Side</label>
                                <input type="number" id="triangle-leds-per-side" class="form-control" value="5" min="2">
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" id="confirm-add-triangle-empty-btn">Create Triangle</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="scale-selected-modal" tabindex="-1" aria-labelledby="scaleSelectedModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="scaleSelectedModalLabel"><i class="bi bi-arrows-angle-expand me-2"></i>Scale Selected LEDs</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>Scale the selection relative to its **geometric center**.</p>
                        <div class="row mb-3">
                            <div class="col">
                                <label for="scale-factor-input" class="form-label">Scale Factor</label>
                                <input type="number" id="scale-factor-input" class="form-control" value="1.5" min="0.1" step="0.1">
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" id="confirm-scale-btn">Scale</button>
                    </div>
                </div>
            </div>
        </div>

    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="util.js" type="module"></script>
    <script src="firebase.js" type="module"></script>
    <script src="canvas.js" type="module"></script>
    <script src="main.js" type="module"></script>

    <input type="file" id="import-file-input" class="d-none" accept=".json,application/json">
</body>

</html>