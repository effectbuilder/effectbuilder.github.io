<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SRGB Interactive Effect Builder</title>
    <meta property="og:title" content="SRGB Interactive Effect Builder">
    <meta property="og:description" content="A tool for creating and sharing visual effects for SignalRGB.">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://joseamirandavelez.github.io/EffectBuilder/logo.png">
    <meta name="twitter:card" content="summary_large_image">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script type="module" src="firebase.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-WS7MGSDJSB"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-WS7MGSDJSB');
</script>

<body class="d-flex flex-column vh-100">
    <nav class="navbar navbar-expand-lg bg-body-tertiary">
        <div class="container-fluid">
            <a class="navbar-brand d-flex align-items-center" href="./">
                <img src="logo.png" alt="Effect Builder Logo" class="me-2" style="height: 1.5em;">
                SRGB Interactive Effect Builder
            </a>
            <div class="ms-auto d-flex align-items-center">

                <div class="btn-group me-3" role="group" aria-label="Project management actions">
                    <button class="btn btn-outline-secondary" id="new-ws-btn" data-bs-toggle="tooltip" title="New Workspace"><i class="bi bi-file-earmark-plus me-1"></i> New</button>
                    <button class="btn btn-outline-primary" id="save-ws-btn" data-bs-toggle="tooltip" title="Save current workspace to the cloud" disabled><i class="bi bi-cloud-arrow-up me-1"></i> Save</button>
                    <button class="btn btn-outline-secondary" id="load-ws-btn" data-bs-toggle="offcanvas" data-bs-target="#gallery-offcanvas" aria-controls="gallery-offcanvas" title="Load one of your saved projects" disabled><i class="bi bi-folder2-open me-1"></i> Open</button>
                    <button class="btn btn-outline-warning" id="browse-btn" data-bs-toggle="offcanvas" data-bs-target="#gallery-offcanvas" aria-controls="gallery-offcanvas" title="Browse the Community Gallery"><i class="bi bi-view-list me-1"></i> Community Gallery</button>
                    <button class="btn btn-outline-info" id="share-btn" data-bs-toggle="tooltip" title="Get a shareable link to this effect" disabled><i class="bi bi-share me-1"></i> Share</button>
                    <button class="btn btn-outline-success" id="export-btn" data-bs-toggle="modal" data-bs-target="#export-options-modal" title="Download complete HTML file"><i class="bi bi-download me-1"></i> Export</button>
                    <button class="btn btn-outline-secondary" id="upload-effect-btn" data-bs-toggle="tooltip" title="Upload an effect HTML file"><i class="bi bi-upload me-1"></i> Upload</button>
                    <button class="btn btn-outline-success" id="generate-srgb-link-btn" data-bs-toggle="tooltip" title="Generate SignalRGB Link. Only works if the effect is already installed."><i class="bi bi-link-45deg"></i>Import to SignalRGB</button>
                </div>

                <input type="file" id="effect-file-input" style="display: none;" accept=".html, .htm">

                <div class="btn-group" role="group" aria-label="Help and settings">
                    <button class="btn btn-outline-secondary" id="help-btn" data-bs-toggle="modal" data-bs-target="#help-modal" title="Help"><i class="bi bi-question-circle"></i></button>
                    <button class="btn btn-outline-secondary" id="about-btn" data-bs-toggle="modal" data-bs-target="#about-modal" title="About"><i class="bi bi-info-circle"></i></button>
                    <a class="btn btn-outline-secondary" id="contact-btn" href="https://github.com/effectbuilder/effectbuilder.github.io/issues/new/choose" target="_blank" rel="noopener" title="Report Bug / Request Feature on GitHub">
                        <i class="bi bi-github"></i>
                    </a>
                    <button class="btn btn-outline-secondary" type="button" id="theme-switcher-btn" title="Change Theme">
                        <i class="bi" id="theme-icon"></i>
                    </button>
                </div>

                <div class="ms-3">
                    <button class="btn btn-outline-success" id="login-btn"><i class="bi bi-google me-2"></i>Sign In</button>

                    <div class="btn-group d-none" id="user-session-group" role="group">
                        <span class="btn btn-outline-secondary d-flex align-items-center disabled" style="pointer-events: none;">
                            <img id="user-photo" class="rounded-circle me-2" style="width: 24px; height: 24px;" alt="User profile photo">
                            <span id="user-display"></span>
                        </span>
                        <button class="btn btn-outline-danger" id="logout-btn" title="Sign Out"><i class="bi bi-box-arrow-right"></i></button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="container-fluid flex-grow-1 overflow-hidden p-0">
        <div class="h-100" id="main-split">
            <div id="left-panel" class="h-100 p-3 border-end bg-body-tertiary" style="overflow: auto;">
                <div class="h-100 d-flex flex-column">
                    <div class="flex-grow-1 overflow-auto pe-2">
                        <h4 class="text-body-emphasis">Controls</h4>
                        <form id="controls-form"></form>
                    </div>
                    <div class="mt-3 d-flex gap-2">
                        <button class="btn btn-success w-100" id="add-object-btn" data-bs-toggle="tooltip" title="Add a new default object to the scene"><i class="bi bi-plus-circle"></i> Add Object</button>
                        <button class="btn btn-primary w-100" id="add-polyline-btn" data-bs-toggle="tooltip" title="Draw a new polyline"><i class="bi bi-pen"></i> Add Polyline</button>
                    </div>
                </div>
            </div>

            <div id="right-panel" class="d-flex flex-column h-100">
                <div id="toolbar" class="bg-body-tertiary p-2 rounded d-flex flex-wrap">
                    <div class="btn-group btn-group-sm me-2 mb-1" role="group" aria-label="History actions">
                        <button class="btn btn-outline-secondary" id="undo-btn" data-bs-toggle="tooltip" title="Undo (Ctrl+Z)" disabled><i class="bi bi-arrow-counterclockwise"></i></button>
                        <button class="btn btn-outline-secondary" id="redo-btn" data-bs-toggle="tooltip" title="Redo (Ctrl+Y)" disabled><i class="bi bi-arrow-clockwise"></i></button>
                    </div>
                    <div class="btn-group btn-group-sm me-2 mb-1" role="group">
                        <button type="button" class="btn btn-outline-secondary" id="copy-props-btn" data-bs-toggle="tooltip" title="Copy Properties"><i class="bi bi-clipboard-plus"></i></button>
                        <button type="button" class="btn btn-outline-secondary" id="paste-props-btn" data-bs-toggle="tooltip" title="Paste Properties" disabled><i class="bi bi-clipboard-check"></i></button>
                    </div>
                    <div class="btn-group btn-group-sm me-2 mb-1" role="group">
                        <button type="button" class="btn btn-outline-secondary" data-action="align-screen-left" data-bs-toggle="tooltip" title="Align Left to Screen"><i class="bi bi-align-start"></i></button>
                        <button type="button" class="btn btn-outline-secondary" data-action="align-screen-h-center" data-bs-toggle="tooltip" title="Align Horizontal Center to Screen"><i class="bi bi-align-center"></i></button>
                        <button type="button" class="btn btn-outline-secondary" data-action="align-screen-right" data-bs-toggle="tooltip" title="Align Right to Screen"><i class="bi bi-align-end"></i></button>
                    </div>
                    <div class="btn-group btn-group-sm me-2 mb-1" role="group">
                        <button type="button" class="btn btn-outline-secondary" data-action="align-screen-top" data-bs-toggle="tooltip" title="Align Top to Screen"><i class="bi bi-align-top"></i></button>
                        <button type="button" class="btn btn-outline-secondary" data-action="align-screen-v-center" data-bs-toggle="tooltip" title="Align Vertical Center to Screen"><i class="bi bi-align-middle"></i></button>
                        <button type="button" class="btn btn-outline-secondary" data-action="align-screen-bottom" data-bs-toggle="tooltip" title="Align Bottom to Screen"><i class="bi bi-align-bottom"></i></button>
                    </div>
                    <div class="btn-group btn-group-sm me-2 mb-1" role="group">
                        <button type="button" class="btn btn-outline-secondary" data-action="match-width" data-bs-toggle="tooltip" title="Match Width of First Selected"><i class="bi bi-arrows-expand-vertical"></i> W</button>
                        <button type="button" class="btn btn-outline-secondary" data-action="match-height" data-bs-toggle="tooltip" title="Match Height of First Selected"><i class="bi bi-arrows-expand"></i> H</button>
                        <button type="button" class="btn btn-outline-secondary" data-action="match-both" data-bs-toggle="tooltip" title="Match Size of First Selected"><i class="bi bi-fullscreen"></i></button>
                        <button type="button" class="btn btn-outline-secondary" data-action="fit-canvas" data-bs-toggle="tooltip" title="Fit to Canvas"><i class="bi bi-arrows-fullscreen"></i></button>
                    </div>
                    <div class="btn-group btn-group-sm me-2 mb-1" role="group">
                        <button type="button" class="btn btn-outline-secondary" id="constrain-btn" data-bs-toggle="tooltip" title="Snap to Canvas"><i class="bi bi-magnet-fill"></i></button>
                        <button type="button" class="btn btn-outline-secondary" id="match-text-size-btn" data-action="match-text-size" data-bs-toggle="tooltip" title="Match Text Size to Cell Height" disabled><i class="bi bi-fonts"></i> <i class="bi bi-grid-3x3"></i></button>
                        <button id="startAudioBtn" class="btn btn-primary">Start Listening</button>
                    </div>
                </div>
                <div id="right-panel-top" class="d-flex flex-column" style="overflow: auto; min-height: 0;">
                    <div id="canvas-container" class="mx-auto">
                        <canvas id="signalCanvas"></canvas>
                    </div>
                </div>
                <div class="ms-auto ps-3 text-body-secondary d-flex align-items-center">
                    <i class="bi bi-crosshair me-2"></i>
                    <span id="coords-display" class="font-monospace" style="min-width: 100px;">---, ---</span>
                </div>
            </div>
        </div>

        <div class="toast-container position-fixed bottom-0 end-0 p-3" style="z-index: 99999">
            <div id="app-toast" class="toast border-0" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="5000" style="width: 350px; font-size: 1.1rem;">
                <div id="app-toast-header" class="toast-header text-white d-flex align-items-center">
                    <i id="app-toast-icon" class="bi me-2"></i>
                    <strong class="me-auto" id="app-toast-title">Notification</strong>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
                <div class="toast-body bg-dark" id="app-toast-body">
                </div>
            </div>
        </div>

        <div class="modal fade" id="load-project-modal" tabindex="-1" aria-labelledby="loadProjectModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="loadProjectModalLabel">Load Project</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>Select a project to load. This will overwrite your current workspace.</p>
                        <ul class="list-group" id="load-project-list"></ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="save-project-modal" tabindex="-1" aria-labelledby="saveProjectModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="saveProjectModalLabel">Save Project</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="save-project-name-input" class="form-label">Project Name:</label>
                            <input type="text" class="form-control" id="save-project-name-input" placeholder="Enter a name for your project...">
                        </div>
                        <hr>
                        <p>Existing Projects:</p>
                        <ul class="list-group" id="save-project-existing-list">
                        </ul>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" id="confirm-save-btn">Save Project</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="notification-modal" tabindex="-1" aria-labelledby="notificationModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="notificationModalLabel">Success</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body" id="notification-modal-body">
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">OK</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="confirm-overwrite-modal" tabindex="-1" aria-labelledby="confirmOverwriteModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="confirmOverwriteModalLabel">Confirm Overwrite</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body" id="confirm-overwrite-modal-body">
                        A project with this name already exists. Do you want to overwrite it?
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-danger" id="confirm-overwrite-btn">Overwrite</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="help-modal" tabindex="-1" aria-labelledby="helpModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-lg modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title me-auto" id="helpModalLabel"><i class="bi bi-question-circle me-2"></i>How to Use the Effect Builder</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>Welcome to the SRGB Interactive Effect Builder! This guide explains the features to help you create stunning visual effects.</p>

                        <div class="ratio ratio-16x9 mb-4">
                            <iframe src="https://www.youtube.com/embed/KSasPw0HScc?si=vCThireMBH0jnnHj" title="SRGB Interactive Effect Builder" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
                        </div>

                        <div class="accordion" id="help-accordion">

                            <div class="accordion-item">
                                <h2 class="accordion-header" id="help-heading-1">
                                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#help-collapse-1" aria-expanded="true" aria-controls="help-collapse-1">
                                        <i class="bi bi-layout-split me-2"></i> Interface Overview
                                    </button>
                                </h2>
                                <div id="help-collapse-1" class="accordion-collapse collapse show" aria-labelledby="help-heading-1">
                                    <div class="accordion-body">
                                        <p>The builder is divided into two main panels:</p>
                                        <ul>
                                            <li>The <strong>Controls Panel</strong> on the left is where you manage all the objects and global settings for your effect.</li>
                                            <li>The <strong>Canvas Panel</strong> on the right contains the visual editor and the main <strong>Toolbar</strong>.</li>
                                        </ul>
                                        <hr>
                                        <h6>Controls Panel (Left)</h6>
                                        <p>Each object gets its own collapsible panel containing tabbed sections for its properties (e.g., Geometry, Fill-Animation, Stroke). You can perform several actions on these panels:</p>
                                        <ul>
                                            <li><strong>Rename:</strong> Click the object's name (e.g., "Object 1") to edit it.</li>
                                            <li><strong>Reorder:</strong> Click and drag the <i class="bi bi-grip-vertical"></i> icon to change the rendering order (layering).</li>
                                            <li><strong>Lock/Unlock:</strong> Use the <i class="bi bi-unlock-fill"></i> / <i class="bi bi-lock-fill"></i> button to prevent an object from being moved on the canvas.</li>
                                            <li><strong>Duplicate/Delete:</strong> Use the menu button (<i class="bi bi-list"></i>) to access options for duplicating or deleting an object.</li>
                                        </ul>
                                        <p>Use the <strong>Global Overrides</strong> in the "General Settings" panel to apply a master color palette or color cycle effect to all objects at once.</p>
                                    </div>
                                </div>
                            </div>

                            <div class="accordion-item">
                                <h2 class="accordion-header" id="help-heading-2">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#help-collapse-2" aria-expanded="false" aria-controls="help-collapse-2">
                                        <i class="bi bi-easel2-fill me-2"></i> The Canvas & Toolbar
                                    </button>
                                </h2>
                                <div id="help-collapse-2" class="accordion-collapse collapse" aria-labelledby="help-heading-2">
                                    <div class="accordion-body">
                                        <h6>Canvas Interaction</h6>
                                        <ul>
                                            <li><strong>Select:</strong> Click an object to select it. Hold <kbd>Shift</kbd> or <kbd>Ctrl</kbd> to select multiple objects.</li>
                                            <li><strong>Manipulate:</strong> Drag a selected object to move it, drag its square handles to resize, or drag its circular handle to rotate.</li>
                                            <li><strong>Snapping:</strong> Objects will automatically snap to the edges and centers of other objects and the canvas for easy alignment.</li>
                                        </ul>
                                        <hr>
                                        <h6>Toolbar</h6>
                                        <p>The toolbar above the canvas provides quick access to powerful tools:</p>
                                        <ul>
                                            <li><strong>History (<i class="bi bi-arrow-counterclockwise"></i> / <i class="bi bi-arrow-clockwise"></i>):</strong> Undo and Redo your recent changes.</li>
                                            <li><strong>Copy/Paste Properties (<i class="bi bi-clipboard-plus"></i> / <i class="bi bi-clipboard-check"></i>):</strong> Copy property groups (like size, color, animation) from one object and paste them onto others.</li>
                                            <li><strong>Alignment & Matching:</strong> With object(s) selected, you can align them to the screen, match their sizes, or fit them to the canvas instantly.</li>
                                            <li><strong>Constrain to Canvas:</strong> Toggle whether objects are allowed to be moved or resized outside the canvas boundaries.</li>
                                        </ul>
                                        <hr>
                                        <h6>Keyboard Shortcuts</h6>
                                        <ul>
                                            <li><kbd>Arrow Keys</kbd>: Nudge selected objects by a small amount.</li>
                                            <li><kbd>Shift</kbd> + <kbd>Arrow Keys</kbd>: Nudge in larger steps.</li>
                                            <li><kbd>Delete</kbd> / <kbd>Backspace</kbd>: Delete selected objects.</li>
                                            <li><kbd>Ctrl/Cmd</kbd> + <kbd>Z</kbd> / <kbd>Y</kbd>: Undo and Redo.</li>
                                            <li><kbd>Ctrl/Cmd</kbd> + <kbd>C</kbd> / <kbd>V</kbd>: Copy/Paste properties.</li>
                                            <li><kbd>Escape</kbd>: Deselect all objects.</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <div class="accordion-item">
                                <h2 class="accordion-header" id="help-heading-3">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#help-collapse-3" aria-expanded="false" aria-controls="help-collapse-3">
                                        <i class="bi bi-stars me-2"></i> Advanced Shapes & Tools
                                    </button>
                                </h2>
                                <div id="help-collapse-3" class="accordion-collapse collapse" aria-labelledby="help-heading-3">
                                    <div class="accordion-body">
                                        <p>The real power of the builder lies in its specialized shapes and tools. When you change an object's <strong>Shape</strong> property, different settings will appear.</p>
                                        <h6>The Polyline Tool</h6>
                                        <ul>
                                            <li><strong>Drawing:</strong> Click the <strong><i class="bi bi-pen"></i> Add Polyline</strong> button. Click on the canvas to place points, then <strong>Double-click</strong> or press <kbd>Enter</kbd> to finish.</li>
                                            <li><strong>Editing Nodes:</strong> After creating a polyline, select it and drag its nodes. <strong>Double-click</strong> a line segment to add a node, or <strong>Alt+Click</strong> a node to delete it.</li>
                                            <li><strong>Features:</strong> Use a polyline as a path for an animation or apply a gradient that flows along the length of the path.</li>
                                        </ul>
                                        <hr>
                                        <h6>The Pixel Art Editor</h6>
                                        <ul>
                                            <li><strong>Editing:</strong> On a `pixel-art` object, click the <kbd><i class="bi bi-pencil-square"></i> Edit</kbd> button on any frame to open the built-in editor.</li>
                                            <li><strong>Tools:</strong> Use the editor's tools to paint, <kbd><i class="bi bi-paint-bucket"></i> Fill</kbd> areas, or <kbd><i class="bi bi-arrow-left-right"></i></kbd> / <kbd><i class="bi bi-arrow-down-up"></i></kbd> flip your art.</li>
                                            <li><strong>Special Colors:</strong> Use the editor's palette to paint with special values that are interpreted by the renderer, like forcing a pixel to be opaque White (1.0), the object's Color 1 (0.3), or Color 2 (0.4).</li>
                                        </ul>
                                        <hr>
                                        <h6>The Pixel Art Gallery</h6>
                                        <ul>
                                            <li><strong>Access:</strong> On a `pixel-art` object, click the <kbd><i class="bi bi-images"></i> Browse Gallery</kbd> button in the "Pixel Art" tab to open the community gallery.</li>
                                            <li><strong>Functionality:</strong> Browse and search for pixel art from public community effects.</li>
                                            <li><strong>Usage:</strong> Clicking <kbd><i class="bi bi-plus-lg me-1"></i> Insert</kbd> on an item will append its animation frames to your currently selected `pixel-art` object.</li>
                                        </ul>
                                        <hr>
                                        <h6>Other Shapes</h6>
                                        <p>Explore other shapes like the <strong>Spawner</strong> (particle system), <strong>Strimer</strong> (cable effects), <strong>Oscilloscope</strong>, and <strong>Tetris</strong>, each with their own unique set of properties to discover.</p>
                                    </div>
                                </div>
                            </div>

                            <div class="accordion-item">
                                <h2 class="accordion-header" id="help-heading-4">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#help-collapse-4" aria-expanded="false" aria-controls="help-collapse-4">
                                        <i class="bi bi-soundwave me-2"></i> Audio & Sensor Reactivity
                                    </button>
                                </h2>
                                <div id="help-collapse-4" class="accordion-collapse collapse" aria-labelledby="help-heading-4">
                                    <div class="accordion-body">
                                        <p>Make your effects dynamic by enabling reactivity in an object's <strong>Audio</strong> or <strong>Sensor</strong> tabs.</p>
                                        <ul>
                                            <li><strong>Audio Reactivity:</strong> To preview, click the <strong>Start Listening</strong> button on the toolbar and share the audio from another browser tab.</li>
                                            <li><strong>Sensor Reactivity:</strong> Create effects that respond to real-time data like CPU load. You can turn an object into a <strong>Sensor Meter</strong> (a filling bar) or a <strong>Time Plot</strong> (a real-time graph).</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <div class="accordion-item">
                                <h2 class="accordion-header" id="help-heading-5">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#help-collapse-5" aria-expanded="false" aria-controls="help-collapse-5">
                                        <i class="bi bi-box-arrow-up-right me-2"></i> Saving, Loading & Exporting
                                    </button>
                                </h2>
                                <div id="help-collapse-5" class="accordion-collapse collapse" aria-labelledby="help-heading-5">
                                    <div class="accordion-body">
                                        <ul>
                                            <li><kbd><i class="bi bi-cloud-arrow-up"></i> Save</kbd>: Saves your current project to your "My Projects" gallery in the cloud. You must be signed in.</li>
                                            <li><kbd><i class="bi bi-folder2-open"></i> Open</kbd>: Opens the gallery panel to load one of your saved projects.</li>
                                            <li><kbd><i class="bi bi-view-list"></i> Community Gallery</kbd>: Opens the gallery panel to browse public effects from all users.</li>
                                            <li><kbd><i class="bi bi-upload"></i> Upload</kbd>: Load an effect from a `.html` file from your computer.</li>
                                            <li><kbd><i class="bi bi-download"></i> Export</kbd>: Generates a <strong>.zip file</strong> containing your effect and a thumbnail, ready to be imported into SignalRGB.</li>
                                            <li><kbd><i class="bi bi-share"></i> Share</kbd>: Saves your project and generates a unique URL that can be opened by other Effect Builder users.</li>
                                            <li><kbd><i class="bi bi-link-45deg"></i> Import to SignalRGB</kbd>: Creates a special link to apply your effect's settings to an *already installed* effect in SignalRGB.</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Got it!</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="terms-modal" tabindex="-1" aria-labelledby="termsModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="termsModalLabel">Terms of Usage</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>By using this Interactive Effect Builder (the "Tool"), you agree to the following terms:</p>

                        <h6 class="mt-4">1. No Warranty</h6>
                        <p>This Tool is provided "as-is", without any warranties of any kind, express or implied. The
                            developer makes no guarantees regarding its functionality, reliability, or suitability for any
                            particular purpose.</p>

                        <h6 class="mt-4">2. Limitation of Liability</h6>
                        <p>In no event shall the developer be liable for any claim, damages, or other liability arising from
                            the use of, or inability to use, the Tool.</p>

                        <h6 class="mt-4">3. User Responsibility</h6>
                        <p>You are solely responsible for the effects you create and their use. It is your responsibility to
                            ensure they comply with the terms of service of any platform or application they are used with,
                            including SignalRGB.</p>

                        <h6 class="mt-4">4. Content Disclaimer</h6>
                        <p>The developer is not responsible for any content, including effects, created or shared by users of this Tool. Some user-generated effects may be inappropriate or unsuitable for certain audiences. Use caution when sharing or loading effects from others.</p>

                        <h6 class="mt-4">5. License</h6>
                        <p>This project is licensed under the GNU General Public License v3.0. You may copy, distribute and modify the software as long as you track changes/dates in source files and keep modifications under the same license. The software is provided "as is", without warranty of any kind. For the full license text, please see the <a href="https://www.gnu.org/licenses/gpl-3.0.html" target="_blank">official GNU GPLv3 page</a>.</p>

                        <h6 class="mt-4">6. Public Content and Licensing</h6>
                        <p>By saving or sharing an effect, you are making it public. You grant a perpetual, worldwide, non-exclusive, royalty-free license to other users and to this website to use, display, reproduce, and distribute your created effect. This allows features like the Community Gallery to function.</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" id="accept-terms2-btn" data-bs-dismiss="modal">I Accept</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="terms-modal" tabindex="-1" aria-labelledby="termsModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="termsModalLabel"><i class="bi bi-file-text me-2"></i>Terms of Usage</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>By using this Interactive Effect Builder (the "Tool"), you agree to the following terms:</p>

                        <h6 class="mt-4">1. No Warranty</h6>
                        <p>This Tool is provided "as-is", without any warranties of any kind, express or implied. The
                            developer makes no guarantees regarding its functionality, reliability, or suitability for any
                            particular purpose.</p>

                        <h6 class="mt-4">2. Limitation of Liability</h6>
                        <p>In no event shall the developer be liable for any claim, damages, or other liability arising from
                            the use of, or inability to use, the Tool.</p>

                        <h6 class="mt-4">3. User Responsibility</h6>
                        <p>You are solely responsible for the effects you create and their use. It is your responsibility to
                            ensure they comply with the terms of service of any platform or application they are used with,
                            including SignalRGB.</p>

                        <h6 class="mt-4">4. Content Disclaimer</h6>
                        <p>The developer is not responsible for any content, including effects, created or shared by users of this Tool. Some user-generated effects may be inappropriate or unsuitable for certain audiences. Use caution when sharing or loading effects from others.</p>

                        <h6 class="mt-4">5. License</h6>
                        <p>This Tool is free to use, modify, and distribute. Attribution is appreciated but not required.
                        </p>

                        <h6 class="mt-4">6. Public Content and Licensing</h6>
                        <p>By saving or sharing an effect, you are making it public. You grant a perpetual, worldwide, non-exclusive, royalty-free license to other users and to this website to use, display, reproduce, and distribute your created effect. This allows features like the Community Gallery to function.</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" id="accept-terms2-btn" data-bs-dismiss="modal">I Accept</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="import-meta-modal" tabindex="-1" aria-labelledby="importMetaModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="importMetaModalLabel"><i class="bi bi-code-slash me-2"></i>Import from Meta Tags</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>Paste the full block of <strong>&lt;meta&gt;</strong> tags from an old effect file below. This will overwrite your current workspace.</p>
                        </p>
                        <textarea class="form-control font-monospace" id="import-textarea" rows="10" placeholder="<meta title=... />&#10;<meta description=... />&#10;..."></textarea>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" id="confirm-import-btn">Import Effect</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="offcanvas offcanvas-end" tabindex="-1" id="gallery-offcanvas" aria-labelledby="galleryOffcanvasLabel" style="width: 700px;">
            <div class="offcanvas-header">
                <h5 class="offcanvas-title" id="galleryOffcanvasLabel"><i class="bi bi-view-list me-2"></i>Community Gallery</h5>
                <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
            </div>
            <div class="offcanvas-body">
                <p>Select an effect to load into your workspace. <a href="gallery.html">View full gallery page <i class="bi bi-box-arrow-up-right"></i></a></p>
                <ul class="list-group" id="gallery-project-list">
                </ul>
            </div>
        </div>

        <div class="modal fade" id="share-modal" tabindex="-1" aria-labelledby="shareModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="shareModalLabel"><i class="bi bi-share-fill me-2"></i>Share Your Effect</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>Anyone with this link can view and load your effect.</p>
                        <div class="input-group">
                            <input type="text" class="form-control" id="share-link-input" readonly>
                            <button class="btn btn-primary" type="button" id="copy-share-link-btn">
                                <i class="bi bi-clipboard"></i> Copy
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="export-options-modal" tabindex="-1" aria-labelledby="exportOptionsModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exportOptionsModalLabel"><i class="bi bi-box-arrow-down me-2"></i>Export Options</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>Your effect is ready. How would you like to export it?</p>
                        <hr>
                        <div class="form-check form-switch my-3">
                            <input class="form-check-input" type="checkbox" id="minimize-props-export">
                            <label class="form-check-label" for="minimize-props-export">Minimize Properties for Export</label>
                            <div class="form-text mt-1">Reduces editable properties to only the essentials, improving load times.</div>
                        </div>
                    </div>
                    <div class="modal-footer justify-content-center">
                        <button type="button" class="btn btn-success" id="export-download-btn"><i class="bi bi-file-earmark-zip-fill me-2"></i>Download .zip File</button>
                        <button type="button" class="btn btn-primary" id="export-copy-btn"><i class="bi bi-clipboard-check-fill me-2"></i>Copy HTML Code</button>
                    </div>
                    <div class="modal-body border-top">
                        <h6 class="text-body-secondary">How to Install in SignalRGB</h6>
                        <ol>
                            <li>Click the <strong>Download .zip File</strong> button.</li>
                            <li>Extract the contents of the '.zip' file into your SignalRGB effects folder, typically found at:<br><code>Documents\WhirlwindFX\Effects</code></li>
                            <li>It is recommended to place the files in a new subfolder for organization.</li>
                            <li>Restart the SignalRGB application. Your new effect will now appear in the effects list.</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="accept-terms-modal" tabindex="-1" aria-labelledby="acceptTermsModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="acceptTermsModalLabel"><i class="bi bi-shield-check me-2"></i>Terms of Usage</h5>
                    </div>
                    <div class="modal-body">
                        <p>By using this tool, you agree to the <a href="#" data-bs-toggle="modal" data-bs-target="#terms-modal" data-bs-dismiss="modal">Terms of Usage</a>.</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" id="accept-terms-btn" data-bs-dismiss="modal">I Accept</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="copy-props-modal" tabindex="-1" aria-labelledby="copyPropsModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="copyPropsModalLabel"><i class="bi bi-clipboard-plus me-2"></i>Copy Properties</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <form id="copy-props-form">
                        <div class="modal-body">
                            <p>Select the property groups you want to copy from the source object.</p>
                            <div class="list-group">
                                <label class="list-group-item">
                                    <input class="form-check-input me-1" type="checkbox" name="copy-position" checked>
                                    Position (X, Y)
                                </label>
                                <label class="list-group-item">
                                    <input class="form-check-input me-1" type="checkbox" name="copy-size" checked>
                                    Size (Width, Height)
                                </label>
                                <label class="list-group-item">
                                    <input class="form-check-input me-1" type="checkbox" name="copy-rotation" checked>
                                    Rotation & Rotation Speed
                                </label>
                                <label class="list-group-item">
                                    <input class="form-check-input me-1" type="checkbox" name="copy-fill-style" checked>
                                    Fill Style (Type, Colors, Gradient)
                                </label>
                                <label class="list-group-item">
                                    <input class="form-check-input me-1" type="checkbox" name="copy-animation" checked>
                                    Fill Animation (Mode, Speed, Direction)
                                </label>
                                <label class="list-group-item">
                                    <input class="form-check-input me-1" type="checkbox" name="copy-color-animation" checked>
                                    Color Animation (Cycle Colors & Speed)
                                </label>
                                <label class="list-group-item">
                                    <input class="form-check-input me-1" type="checkbox" name="copy-shape-type">
                                    Shape Type
                                </label>
                                <label class="list-group-item d-none" id="shape-specific-props-container">
                                    <input class="form-check-input me-1" type="checkbox" name="copy-shape-specific">
                                    Shape-Specific Properties (<span id="shape-specific-name"></span>)
                                </label>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-primary" id="confirm-copy-props-btn">Copy to Clipboard</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="modal fade" id="pixelArtEditorModal" tabindex="-1" aria-labelledby="pixelArtEditorModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="pixelArtEditorModalLabel">Pixel Art Editor</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="row align-items-end mb-3">
                            <div class="col-md-4">
                                <label for="pixel-editor-width" class="form-label-sm">Grid Width</label>
                                <input type="number" class="form-control" id="pixel-editor-width" value="16" min="1" max="64">
                            </div>
                            <div class="col-md-4">
                                <label for="pixel-editor-height" class="form-label-sm">Grid Height</label>
                                <input type="number" class="form-control" id="pixel-editor-height" value="16" min="1" max="64">
                            </div>
                            <div class="col-md-4">
                                <button type="button" class="btn btn-outline-secondary w-100" id="pixel-editor-resize-btn">Apply New Size</button>
                            </div>
                        </div>
                        <hr>
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <div class="d-flex align-items-center">
                                <strong class="me-3">Tools:</strong>
                                <div class="btn-group" role="group" id="pixel-editor-tools">
                                    <button type="button" class="btn btn-sm btn-outline-secondary" id="pixel-editor-fill-btn" title="Fill Area"><i class="bi bi-paint-bucket"></i> Fill</button>
                                    <button type="button" class="btn btn-sm btn-outline-secondary" id="pixel-editor-mirror-h-btn" title="Flip Horizontal"><i class="bi bi-arrow-left-right"></i></button>
                                    <button type="button" class="btn btn-sm btn-outline-secondary" id="pixel-editor-mirror-v-btn" title="Flip Vertical"><i class="bi bi-arrow-down-up"></i></button>
                                </div>
                            </div>
                            <div class="d-flex align-items-center">
                                <strong class="me-3">Paint:</strong>
                                <div class="btn-group" role="group" id="pixel-editor-palette">
                                    <button type="button" class="btn btn-sm btn-outline-light active" data-value="0.7" style="background: repeating-conic-gradient(#808080 0% 25%, #a0a0a0 0% 50%) 50% / 10px 10px;" title="Use object's main fill style (value: 0.7)">Selected Fill</button>
                                    <button type="button" class="btn btn-sm btn-outline-light" data-value="1.0" style="background-color: #FFF; color: #000;" title="White (value: 1.0)">White</button>
                                    <button type="button" class="btn btn-sm btn-outline-light" data-value="0.3" id="pixel-editor-color1-btn" title="Color 1 (value: 0.3)">Color 1</button>
                                    <button type="button" class="btn btn-sm btn-outline-light" data-value="0.4" id="pixel-editor-color2-btn" title="Color 2 (value: 0.4)">Color 2</button>
                                    <button type="button" class="btn btn-sm btn-outline-light" data-value="0" style="background-color: #000; color: #FFF;" title="Black (value: 0)">Black</button>
                                </div>
                            </div>
                        </div>
                        <div id="pixel-editor-grid-container" class="bg-dark p-1" style="cursor: pointer; user-select: none;">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" id="pixel-editor-save-btn">Apply Changes</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="pixel-art-gallery-modal" tabindex="-1" aria-labelledby="pixelArtGalleryModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="pixelArtGalleryModalLabel"><i class="bi bi-substack me-2"></i>Community Pixel Art</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="row mb-3">
                            <div class="col-12">
                                <div class="input-group">
                                    <span class="input-group-text"><i class="bi bi-search"></i></span>
                                    <input type="text" id="pixel-art-search-input" class="form-control" placeholder="Search by effect name or creator...">
                                </div>
                            </div>
                        </div>
                        <div id="modal-pixel-art-container" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
                        </div>
                    </div>
                    <div class="modal-footer d-flex justify-content-center">
                        <nav aria-label="Pixel Art Gallery Pagination">
                            <ul class="pagination mb-0" id="pixel-art-pagination-container">
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://unpkg.com/split.js/dist/split.min.js"></script>
        <script src="Shape.js"></script>
        <script src="util.js"></script>
        <script src="main.js"></script>
</body>

</html>